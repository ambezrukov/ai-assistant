<?xml version="1.0" encoding="UTF-8"?>
<TaskerData sr="" dvi="1" tv="6.2.21">
    <!--
        Tasker проект для AI-ассистента

        Профили:
        1. AI Assistant - Voice (долгое нажатие кнопки питания)
        2. AI Assistant - Headset Button (кнопка на наушниках)

        Задачи:
        1. Voice Command - запись и отправка голосовой команды
        2. Play Response - воспроизведение ответа
        3. Handle Confirmation - обработка подтверждений
    -->

    <!-- Профиль 1: Длинное нажатие кнопки питания -->
    <Profile sr="prof1" ve="2">
        <cdate>1704672000000</cdate>
        <edate>1704672000000</edate>
        <flags>8</flags>
        <id>1</id>
        <mid0>2</mid0>
        <Event sr="con0" ve="2">
            <code>26</code>
            <pri>0</pri>
            <Str sr="arg0" ve="3">power</Str>
            <Int sr="arg1" val="1"/>
        </Event>
        <nme>AI Assistant - Voice (Power Button)</nme>
    </Profile>

    <!-- Профиль 2: Кнопка наушников -->
    <Profile sr="prof2" ve="2">
        <cdate>1704672000000</cdate>
        <edate>1704672000000</edate>
        <flags>8</flags>
        <id>2</id>
        <mid0>2</mid0>
        <Event sr="con0" ve="2">
            <code>23</code>
            <pri>0</pri>
            <Str sr="arg0" ve="3">media_button</Str>
            <Int sr="arg1" val="79"/>
        </Event>
        <nme>AI Assistant - Headset Button</nme>
    </Profile>

    <!-- Задача 1: Запись и отправка голосовой команды -->
    <Task sr="task2">
        <cdate>1704672000000</cdate>
        <edate>1704672000000</edate>
        <id>2</id>
        <nme>Voice Command</nme>

        <!-- Переменные конфигурации -->
        <Action sr="act1" ve="7">
            <code>547</code>
            <Str sr="arg0" ve="3">%API_URL</Str>
            <Str sr="arg1" ve="3">https://your-domain.com/api/v1/voice-command</Str>
            <Int sr="arg2" val="0"/>
            <Int sr="arg3" val="0"/>
        </Action>

        <Action sr="act2" ve="7">
            <code>547</code>
            <Str sr="arg0" ve="3">%API_TOKEN</Str>
            <Str sr="arg1" ve="3">your-bearer-token-here</Str>
            <Int sr="arg2" val="0"/>
            <Int sr="arg3" val="0"/>
        </Action>

        <Action sr="act3" ve="7">
            <code>547</code>
            <Str sr="arg0" ve="3">%USER_ID</Str>
            <Str sr="arg1" ve="3">telegram_user_id</Str>
            <Int sr="arg2" val="0"/>
            <Int sr="arg3" val="0"/>
        </Action>

        <!-- Вибрация - начало записи -->
        <Action sr="act4" ve="7">
            <code>137</code>
            <Int sr="arg0" val="200"/>
        </Action>

        <!-- Голосовое уведомление -->
        <Action sr="act5" ve="7">
            <code>130</code>
            <Str sr="arg0" ve="3">Слушаю</Str>
            <Str sr="arg1" ve="3">ru:default</Str>
            <Int sr="arg2" val="5"/>
            <Int sr="arg3" val="5"/>
            <Int sr="arg4" val="0"/>
            <Int sr="arg5" val="1"/>
        </Action>

        <!-- Записать голос (5 секунд) -->
        <Action sr="act6" ve="7">
            <code>363</code>
            <Str sr="arg0" ve="3">voice_command.m4a</Str>
            <Int sr="arg1" val="1"/>
            <Int sr="arg2" val="5"/>
            <Int sr="arg3" val="2"/>
        </Action>

        <!-- Вибрация - конец записи -->
        <Action sr="act7" ve="7">
            <code>137</code>
            <Int sr="arg0" val="100"/>
        </Action>

        <!-- Отправить файл на API -->
        <Action sr="act8" ve="7">
            <code>339</code>
            <Str sr="arg0" ve="3">%API_URL</Str>
            <Str sr="arg1" ve="3"/>
            <Str sr="arg2" ve="3">multipart/form-data</Str>
            <Str sr="arg3" ve="3">audio:voice_command.m4a</Str>
            <Str sr="arg4" ve="3">user_id:%USER_ID</Str>
            <Str sr="arg5" ve="3"/>
            <Str sr="arg6" ve="3">Authorization:Bearer %API_TOKEN</Str>
            <Str sr="arg7" ve="3"/>
            <Int sr="arg8" val="30"/>
            <Str sr="arg9" ve="3">%http_response</Str>
            <Int sr="arg10" val="0"/>
        </Action>

        <!-- Парсинг JSON ответа -->
        <Action sr="act9" ve="7">
            <code>590</code>
            <Str sr="arg0" ve="3">%http_response</Str>
            <Str sr="arg1" ve="3">message</Str>
            <Int sr="arg2" val="0"/>
            <Str sr="arg3" ve="3">%response_text</Str>
            <Int sr="arg4" val="0"/>
        </Action>

        <Action sr="act10" ve="7">
            <code>590</code>
            <Str sr="arg0" ve="3">%http_response</Str>
            <Str sr="arg1" ve="3">audio_url</Str>
            <Int sr="arg2" val="0"/>
            <Str sr="arg3" ve="3">%audio_url</Str>
            <Int sr="arg4" val="0"/>
        </Action>

        <Action sr="act11" ve="7">
            <code>590</code>
            <Str sr="arg0" ve="3">%http_response</Str>
            <Str sr="arg1" ve="3">action</Str>
            <Int sr="arg2" val="0"/>
            <Str sr="arg3" ve="3">%action_type</Str>
            <Int sr="arg4" val="0"/>
        </Action>

        <Action sr="act12" ve="7">
            <code>590</code>
            <Str sr="arg0" ve="3">%http_response</Str>
            <Str sr="arg1" ve="3">confirmation_id</Str>
            <Int sr="arg2" val="0"/>
            <Str sr="arg3" ve="3">%confirmation_id</Str>
            <Int sr="arg4" val="0"/>
        </Action>

        <!-- Если есть аудио, воспроизвести -->
        <Action sr="act13" ve="7">
            <code>37</code>
            <ConditionList sr="if">
                <Condition sr="c0" ve="3">
                    <lhs>%audio_url</lhs>
                    <op>12</op>
                    <rhs>https://</rhs>
                </Condition>
            </ConditionList>
        </Action>

        <!-- Скачать аудио файл -->
        <Action sr="act14" ve="7">
            <code>116</code>
            <Str sr="arg0" ve="3">%audio_url</Str>
            <Str sr="arg1" ve="3">response_audio.mp3</Str>
            <Str sr="arg2" ve="3"/>
            <Int sr="arg3" val="0"/>
            <Int sr="arg4" val="10"/>
            <Str sr="arg5" ve="3"/>
            <Int sr="arg6" val="1"/>
        </Action>

        <!-- Воспроизвести ответ -->
        <Action sr="act15" ve="7">
            <code>361</code>
            <Str sr="arg0" ve="3">response_audio.mp3</Str>
            <Int sr="arg1" val="10"/>
            <Int sr="arg2" val="0"/>
            <Int sr="arg3" val="0"/>
            <Int sr="arg4" val="0"/>
        </Action>

        <!-- Конец IF аудио -->
        <Action sr="act16" ve="7">
            <code>43</code>
        </Action>

        <!-- Если требуется подтверждение -->
        <Action sr="act17" ve="7">
            <code>37</code>
            <ConditionList sr="if">
                <Condition sr="c0" ve="3">
                    <lhs>%action_type</lhs>
                    <op>0</op>
                    <rhs>confirm</rhs>
                </Condition>
            </ConditionList>
        </Action>

        <!-- Показать диалог подтверждения -->
        <Action sr="act18" ve="7">
            <code>876</code>
            <Str sr="arg0" ve="3">Подтверждение</Str>
            <Str sr="arg1" ve="3">%response_text</Str>
            <Str sr="arg2" ve="3"/>
            <Str sr="arg3" ve="3">Да</Str>
            <Str sr="arg4" ve="3">Нет</Str>
            <Str sr="arg5" ve="3"/>
            <Int sr="arg6" val="10"/>
            <Int sr="arg7" val="0"/>
            <Int sr="arg8" val="0"/>
        </Action>

        <!-- Если нажали Да -->
        <Action sr="act19" ve="7">
            <code>37</code>
            <ConditionList sr="if">
                <Condition sr="c0" ve="3">
                    <lhs>%act_button</lhs>
                    <op>0</op>
                    <rhs>Да</rhs>
                </Condition>
            </ConditionList>
        </Action>

        <!-- Отправить подтверждение -->
        <Action sr="act20" ve="7">
            <code>339</code>
            <Str sr="arg0" ve="3">https://your-domain.com/api/v1/confirm</Str>
            <Str sr="arg1" ve="3"/>
            <Str sr="arg2" ve="3">application/json</Str>
            <Str sr="arg3" ve="3">{"confirmation_id":"%confirmation_id","user_id":"%USER_ID","confirmed":true}</Str>
            <Str sr="arg4" ve="3"/>
            <Str sr="arg5" ve="3"/>
            <Str sr="arg6" ve="3">Authorization:Bearer %API_TOKEN</Str>
            <Str sr="arg7" ve="3"/>
            <Int sr="arg8" val="30"/>
            <Str sr="arg9" ve="3">%confirm_response</Str>
            <Int sr="arg10" val="0"/>
        </Action>

        <!-- Озвучить результат -->
        <Action sr="act21" ve="7">
            <code>590</code>
            <Str sr="arg0" ve="3">%confirm_response</Str>
            <Str sr="arg1" ve="3">message</Str>
            <Int sr="arg2" val="0"/>
            <Str sr="arg3" ve="3">%final_message</Str>
            <Int sr="arg4" val="0"/>
        </Action>

        <Action sr="act22" ve="7">
            <code>130</code>
            <Str sr="arg0" ve="3">%final_message</Str>
            <Str sr="arg1" ve="3">ru:default</Str>
            <Int sr="arg2" val="5"/>
            <Int sr="arg3" val="5"/>
            <Int sr="arg4" val="0"/>
            <Int sr="arg5" val="1"/>
        </Action>

        <!-- Конец IF Да -->
        <Action sr="act23" ve="7">
            <code>43</code>
        </Action>

        <!-- Конец IF confirm -->
        <Action sr="act24" ve="7">
            <code>43</code>
        </Action>

        <!-- Удалить временные файлы -->
        <Action sr="act25" ve="7">
            <code>410</code>
            <Str sr="arg0" ve="3">voice_command.m4a</Str>
            <Int sr="arg1" val="0"/>
            <Int sr="arg2" val="0"/>
        </Action>

        <Action sr="act26" ve="7">
            <code>410</code>
            <Str sr="arg0" ve="3">response_audio.mp3</Str>
            <Int sr="arg1" val="0"/>
            <Int sr="arg2" val="0"/>
        </Action>
    </Task>

    <!-- Задача 2: Быстрая текстовая команда (для тестирования) -->
    <Task sr="task3">
        <cdate>1704672000000</cdate>
        <edate>1704672000000</edate>
        <id>3</id>
        <nme>Text Command</nme>

        <!-- Запросить текст -->
        <Action sr="act1" ve="7">
            <code>590</code>
            <Str sr="arg0" ve="3">Введите команду</Str>
            <Str sr="arg1" ve="3">Команда для AI</Str>
            <Int sr="arg2" val="0"/>
            <Str sr="arg3" ve="3">%command_text</Str>
            <Int sr="arg4" val="0"/>
        </Action>

        <!-- Отправить на API -->
        <Action sr="act2" ve="7">
            <code>339</code>
            <Str sr="arg0" ve="3">https://your-domain.com/api/v1/text-command</Str>
            <Str sr="arg1" ve="3"/>
            <Str sr="arg2" ve="3">application/json</Str>
            <Str sr="arg3" ve="3">{"text":"%command_text","user_id":"%USER_ID"}</Str>
            <Str sr="arg4" ve="3"/>
            <Str sr="arg5" ve="3"/>
            <Str sr="arg6" ve="3">Authorization:Bearer %API_TOKEN</Str>
            <Str sr="arg7" ve="3"/>
            <Int sr="arg8" val="30"/>
            <Str sr="arg9" ve="3">%http_response</Str>
            <Int sr="arg10" val="0"/>
        </Action>

        <!-- Показать результат -->
        <Action sr="act3" ve="7">
            <code>590</code>
            <Str sr="arg0" ve="3">%http_response</Str>
            <Str sr="arg1" ve="3">message</Str>
            <Int sr="arg2" val="0"/>
            <Str sr="arg3" ve="3">%response_text</Str>
            <Int sr="arg4" val="0"/>
        </Action>

        <Action sr="act4" ve="7">
            <code>523</code>
            <Str sr="arg0" ve="3">%response_text</Str>
            <Int sr="arg1" val="1"/>
        </Action>
    </Task>
</TaskerData>
