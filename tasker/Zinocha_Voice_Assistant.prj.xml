<?xml version="1.0" encoding="UTF-8"?>
<TaskerData sr="" dvi="1" tv="6.2.23">
    <Project sr="proj0" ve="2">
        <name>Zinocha Voice Assistant</name>

        <!-- Profile 1: Wake Word Activation -->
        <Profile sr="prof1" ve="2">
            <cdate>1736524800000</cdate>
            <edate>1736524800000</edate>
            <id>1</id>
            <mid0>2</mid0>
            <Event sr="con0" ve="2">
                <code>900</code>
                <pri>0</pri>
                <Str sr="arg0" ve="3">–∑–∏–Ω–æ—á–∫–∞</Str>
                <Str sr="arg1" ve="3"></Str>
                <Int sr="arg2" val="0"/>
                <Str sr="arg3" ve="3"></Str>
                <Str sr="arg4" ve="3"></Str>
                <Str sr="arg5" ve="3">com.joaomgcd.autovoice</Str>
            </Event>
        </Profile>

        <!-- Task 1: Zinocha Activated -->
        <Task sr="task2">
            <cdate>1736524800000</cdate>
            <edate>1736524800000</edate>
            <id>2</id>
            <nme>Zinocha Activated</nme>
            <pri>100</pri>

            <!-- Action 1: Play activation sound -->
            <Action sr="act0" ve="7">
                <code>410</code>
                <label>Play Activation Sound</label>
                <Str sr="arg0" ve="3">/sdcard/Tasker/sounds/listening.mp3</Str>
                <Int sr="arg1" val="5"/>
                <Int sr="arg2" val="0"/>
                <Int sr="arg3" val="0"/>
                <Int sr="arg4" val="0"/>
            </Action>

            <!-- Action 2: Show dialog -->
            <Action sr="act1" ve="7">
                <code>543</code>
                <label>Show Mode Selection</label>
                <Str sr="arg0" ve="3">–ó–∏–Ω–æ—á–∫–∞</Str>
                <Str sr="arg1" ve="3">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º –≤–≤–æ–¥–∞:</Str>
                <Img sr="arg2" ve="2"/>
                <Str sr="arg3" ve="3">üé§ –ì–æ–ª–æ—Å</Str>
                <Str sr="arg4" ve="3">‚å®Ô∏è –¢–µ–∫—Å—Ç</Str>
                <Str sr="arg5" ve="3">‚ùå –û—Ç–º–µ–Ω–∞</Str>
                <Int sr="arg6" val="20000"/>
                <Int sr="arg7" val="0"/>
                <Int sr="arg8" val="1"/>
                <Int sr="arg9" val="0"/>
            </Action>

            <!-- Action 3: If voice selected -->
            <Action sr="act2" ve="7">
                <code>37</code>
                <ConditionList sr="if">
                    <Condition sr="c0" ve="3">
                        <lhs>%dr_button</lhs>
                        <op>2</op>
                        <rhs>1</rhs>
                    </Condition>
                </ConditionList>
            </Action>

            <!-- Action 4: Run Voice Input Task -->
            <Action sr="act3" ve="7">
                <code>130</code>
                <label>Voice Input</label>
                <Str sr="arg0" ve="3">Voice Input Task</Str>
                <Int sr="arg1" val="20"/>
                <Str sr="arg2" ve="3"></Str>
            </Action>

            <!-- Action 5: End If -->
            <Action sr="act4" ve="7">
                <code>43</code>
            </Action>

            <!-- Action 6: If text selected -->
            <Action sr="act5" ve="7">
                <code>37</code>
                <ConditionList sr="if">
                    <Condition sr="c0" ve="3">
                        <lhs>%dr_button</lhs>
                        <op>2</op>
                        <rhs>2</rhs>
                    </Condition>
                </ConditionList>
            </Action>

            <!-- Action 7: Run Text Input Task -->
            <Action sr="act6" ve="7">
                <code>130</code>
                <label>Text Input</label>
                <Str sr="arg0" ve="3">Text Input Task</Str>
                <Int sr="arg1" val="20"/>
                <Str sr="arg2" ve="3"></Str>
            </Action>

            <!-- Action 8: End If -->
            <Action sr="act7" ve="7">
                <code>43</code>
            </Action>
        </Task>

        <!-- Task 2: Voice Input Task -->
        <Task sr="task3">
            <cdate>1736524800000</cdate>
            <edate>1736524800000</edate>
            <id>3</id>
            <nme>Voice Input Task</nme>
            <pri>100</pri>

            <!-- Action 1: Record voice via AutoVoice -->
            <Action sr="act0" ve="7">
                <code>900</code>
                <label>Record Voice</label>
                <Bundle sr="arg0">
                    <SimpleString sr="arg0" ve="3">com.joaomgcd.autovoice</SimpleString>
                    <SimpleString sr="arg1" ve="3">com.joaomgcd.autovoice.activity.ActivityConfigRecognize</SimpleString>
                    <SimpleString sr="arg2" ve="3">timeout=10|language=ru-RU</SimpleString>
                    <SimpleString sr="arg3" ve="3">AutoVoice Recognize</SimpleString>
                </Bundle>
            </Action>

            <!-- Action 2: HTTP POST voice to server -->
            <Action sr="act1" ve="7">
                <code>116</code>
                <label>Send to Server</label>
                <Str sr="arg0" ve="3">%API_URL%/voice-command</Str>
                <Str sr="arg1" ve="3">multipart/form-data</Str>
                <Str sr="arg2" ve="3">audio=%avcomm_audio_file
user_id=%ANDROIDID</Str>
                <Str sr="arg3" ve="3">Authorization: Bearer %API_TOKEN</Str>
                <Str sr="arg4" ve="3">/sdcard/Tasker/response.json</Str>
                <Int sr="arg5" val="30"/>
                <Str sr="arg6" ve="3"></Str>
                <Str sr="arg7" ve="3"></Str>
            </Action>

            <!-- Action 3: Parse JSON response -->
            <Action sr="act2" ve="7">
                <code>122</code>
                <label>Parse Response</label>
                <Str sr="arg0" ve="3">var response = JSON.parse(global('HTTPD'));
setGlobal('RESPONSE_TEXT', response.response_text);
setGlobal('RESPONSE_ACTION', response.action);
setGlobal('RESPONSE_AUDIO', response.audio_url);
setGlobal('CONFIRMATION_ID', response.confirmation_id);</Str>
                <Str sr="arg1" ve="3"></Str>
                <Int sr="arg2" val="1"/>
                <Int sr="arg3" val="45"/>
            </Action>

            <!-- Action 4: Download TTS audio -->
            <Action sr="act3" ve="7">
                <code>339</code>
                <label>Download Audio</label>
                <Str sr="arg0" ve="3">%RESPONSE_AUDIO%</Str>
                <Str sr="arg1" ve="3"></Str>
                <Str sr="arg2" ve="3">/sdcard/Tasker/response.mp3</Str>
                <Str sr="arg3" ve="3"></Str>
                <Str sr="arg4" ve="3"></Str>
                <Str sr="arg5" ve="3"></Str>
                <Str sr="arg6" ve="3"></Str>
                <Str sr="arg7" ve="3"></Str>
                <Int sr="arg8" val="30"/>
            </Action>

            <!-- Action 5: Play response -->
            <Action sr="act4" ve="7">
                <code>410</code>
                <label>Play Response</label>
                <Str sr="arg0" ve="3">/sdcard/Tasker/response.mp3</Str>
                <Int sr="arg1" val="5"/>
                <Int sr="arg2" val="0"/>
                <Int sr="arg3" val="0"/>
                <Int sr="arg4" val="0"/>
            </Action>

            <!-- Action 6: If confirmation needed -->
            <Action sr="act5" ve="7">
                <code>37</code>
                <ConditionList sr="if">
                    <Condition sr="c0" ve="3">
                        <lhs>%RESPONSE_ACTION%</lhs>
                        <op>2</op>
                        <rhs>confirm</rhs>
                    </Condition>
                </ConditionList>
            </Action>

            <!-- Action 7: Wait -->
            <Action sr="act6" ve="7">
                <code>30</code>
                <Int sr="arg0" val="1000"/>
                <Int sr="arg1" val="0"/>
            </Action>

            <!-- Action 8: Show confirmation dialog -->
            <Action sr="act7" ve="7">
                <code>543</code>
                <label>Confirmation Dialog</label>
                <Str sr="arg0" ve="3">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</Str>
                <Str sr="arg1" ve="3">–°–∫–∞–∂–∏—Ç–µ "–î–∞" –∏–ª–∏ "–ù–µ—Ç"</Str>
                <Img sr="arg2" ve="2"/>
                <Str sr="arg3" ve="3"></Str>
                <Str sr="arg4" ve="3"></Str>
                <Str sr="arg5" ve="3"></Str>
                <Int sr="arg6" val="20000"/>
                <Int sr="arg7" val="0"/>
                <Int sr="arg8" val="1"/>
                <Int sr="arg9" val="0"/>
            </Action>

            <!-- Action 9: Record confirmation voice -->
            <Action sr="act8" ve="7">
                <code>900</code>
                <label>Record Confirmation</label>
                <Bundle sr="arg0">
                    <SimpleString sr="arg0" ve="3">com.joaomgcd.autovoice</SimpleString>
                    <SimpleString sr="arg1" ve="3">com.joaomgcd.autovoice.activity.ActivityConfigRecognize</SimpleString>
                    <SimpleString sr="arg2" ve="3">timeout=5|language=ru-RU</SimpleString>
                    <SimpleString sr="arg3" ve="3">AutoVoice Recognize</SimpleString>
                </Bundle>
            </Action>

            <!-- Action 10: HTTP POST voice confirmation -->
            <Action sr="act9" ve="7">
                <code>116</code>
                <label>Send Confirmation</label>
                <Str sr="arg0" ve="3">%API_URL%/voice-confirm</Str>
                <Str sr="arg1" ve="3">multipart/form-data</Str>
                <Str sr="arg2" ve="3">audio=%avcomm_audio_file
confirmation_id=%CONFIRMATION_ID%
user_id=%ANDROIDID</Str>
                <Str sr="arg3" ve="3">Authorization: Bearer %API_TOKEN</Str>
                <Str sr="arg4" ve="3">/sdcard/Tasker/confirm_response.json</Str>
                <Int sr="arg5" val="30"/>
                <Str sr="arg6" ve="3"></Str>
                <Str sr="arg7" ve="3"></Str>
            </Action>

            <!-- Action 11-13: Parse and play confirmation response (same as 3-5) -->
            <Action sr="act10" ve="7">
                <code>122</code>
                <label>Parse Confirmation</label>
                <Str sr="arg0" ve="3">var response = JSON.parse(global('HTTPD'));
setGlobal('RESPONSE_AUDIO', response.audio_url);</Str>
                <Str sr="arg1" ve="3"></Str>
                <Int sr="arg2" val="1"/>
                <Int sr="arg3" val="45"/>
            </Action>

            <Action sr="act11" ve="7">
                <code>339</code>
                <label>Download Confirmation Audio</label>
                <Str sr="arg0" ve="3">%RESPONSE_AUDIO%</Str>
                <Str sr="arg1" ve="3"></Str>
                <Str sr="arg2" ve="3">/sdcard/Tasker/confirm_response.mp3</Str>
                <Str sr="arg3" ve="3"></Str>
                <Str sr="arg4" ve="3"></Str>
                <Str sr="arg5" ve="3"></Str>
                <Str sr="arg6" ve="3"></Str>
                <Str sr="arg7" ve="3"></Str>
                <Int sr="arg8" val="30"/>
            </Action>

            <Action sr="act12" ve="7">
                <code>410</code>
                <label>Play Confirmation</label>
                <Str sr="arg0" ve="3">/sdcard/Tasker/confirm_response.mp3</Str>
                <Int sr="arg1" val="5"/>
                <Int sr="arg2" val="0"/>
                <Int sr="arg3" val="0"/>
                <Int sr="arg4" val="0"/>
            </Action>

            <!-- Action 14: End If -->
            <Action sr="act13" ve="7">
                <code>43</code>
            </Action>
        </Task>

        <!-- Task 3: Text Input Task -->
        <Task sr="task4">
            <cdate>1736524800000</cdate>
            <edate>1736524800000</edate>
            <id>4</id>
            <nme>Text Input Task</nme>
            <pri>100</pri>

            <!-- Action 1: Show input dialog -->
            <Action sr="act0" ve="7">
                <code>552</code>
                <label>Text Input</label>
                <Str sr="arg0" ve="3">–ó–∏–Ω–æ—á–∫–∞</Str>
                <Str sr="arg1" ve="3">–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –∑–∞–ø—Ä–æ—Å:</Str>
                <Img sr="arg2" ve="2"/>
                <Str sr="arg3" ve="3">%INPUT_TEXT%</Str>
                <Int sr="arg4" val="0"/>
                <Int sr="arg5" val="20000"/>
                <Int sr="arg6" val="1"/>
            </Action>

            <!-- Action 2: HTTP POST text -->
            <Action sr="act1" ve="7">
                <code>116</code>
                <label>Send Text</label>
                <Str sr="arg0" ve="3">%API_URL%/text-command</Str>
                <Str sr="arg1" ve="3">application/json</Str>
                <Str sr="arg2" ve="3">{"text":"%INPUT_TEXT%","user_id":"%ANDROIDID%"}</Str>
                <Str sr="arg3" ve="3">Authorization: Bearer %API_TOKEN</Str>
                <Str sr="arg4" ve="3">/sdcard/Tasker/response.json</Str>
                <Int sr="arg5" val="30"/>
                <Str sr="arg6" ve="3"></Str>
                <Str sr="arg7" ve="3"></Str>
            </Action>

            <!-- Actions 3-14: Same as Voice Input Task (parse, play, confirm if needed) -->
            <!-- ... (–∫–æ–ø–∏—è –¥–µ–π—Å—Ç–≤–∏–π –∏–∑ Voice Input Task) ... -->
        </Task>
    </Project>
</TaskerData>
