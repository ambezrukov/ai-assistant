"""
–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (tools) –¥–ª—è Claude Function Calling
"""

from typing import List, Dict, Any


# –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è Claude
TOOLS: List[Dict[str, Any]] = [
    {
        "name": "add_calendar_event",
        "description": "–î–æ–±–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ –≤ Google Calendar. –ò—Å–ø–æ–ª—å–∑—É–π —ç—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–∏—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –≤—Å—Ç—Ä–µ—á—É, —Å–æ–±—ã—Ç–∏–µ –∏–ª–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ.",
        "input_schema": {
            "type": "object",
            "properties": {
                "summary": {
                    "type": "string",
                    "description": "–ù–∞–∑–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, '–í—Å—Ç—Ä–µ—á–∞ —Å –≤—Ä–∞—á–æ–º')"
                },
                "start_time": {
                    "type": "string",
                    "description": "–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ ISO 8601 (–Ω–∞–ø—Ä–∏–º–µ—Ä, '2025-01-09T15:00:00')"
                },
                "end_time": {
                    "type": "string",
                    "description": "–í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ ISO 8601 (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ). –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é +1 —á–∞—Å –æ—Ç start_time"
                },
                "description": {
                    "type": "string",
                    "description": "–û–ø–∏—Å–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)"
                },
                "location": {
                    "type": "string",
                    "description": "–ú–µ—Å—Ç–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)"
                }
            },
            "required": ["summary", "start_time"]
        }
    },
    {
        "name": "get_calendar_events",
        "description": "–ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Å–æ–±—ã—Ç–∏–π –∏–∑ Google Calendar –∑–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥. –ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç '—á—Ç–æ —É –º–µ–Ω—è –∑–∞–≤—Ç—Ä–∞/–Ω–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ' –∏ —Ç.–ø.",
        "input_schema": {
            "type": "object",
            "properties": {
                "time_min": {
                    "type": "string",
                    "description": "–ù–∞—á–∞–ª–æ –ø–µ—Ä–∏–æ–¥–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ ISO 8601 (–Ω–∞–ø—Ä–∏–º–µ—Ä, '2025-01-09T00:00:00')"
                },
                "time_max": {
                    "type": "string",
                    "description": "–ö–æ–Ω–µ—Ü –ø–µ—Ä–∏–æ–¥–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ ISO 8601 (–Ω–∞–ø—Ä–∏–º–µ—Ä, '2025-01-10T23:59:59')"
                },
                "max_results": {
                    "type": "integer",
                    "description": "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–±—ã—Ç–∏–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10)"
                }
            },
            "required": ["time_min", "time_max"]
        }
    },
    {
        "name": "add_task",
        "description": "–î–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–¥–∞—á—É –≤ Google Tasks. –ò—Å–ø–æ–ª—å–∑—É–π –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –∑–∞–¥–∞—á (–ù–ï –¥–ª—è –ø–æ–∫—É–ø–æ–∫).",
        "input_schema": {
            "type": "object",
            "properties": {
                "title": {
                    "type": "string",
                    "description": "–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏"
                },
                "notes": {
                    "type": "string",
                    "description": "–û–ø–∏—Å–∞–Ω–∏–µ/–∑–∞–º–µ—Ç–∫–∏ –∫ –∑–∞–¥–∞—á–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)"
                },
                "due_date": {
                    "type": "string",
                    "description": "–°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ ISO 8601 (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)"
                }
            },
            "required": ["title"]
        }
    },
    {
        "name": "add_shopping_item",
        "description": "–î–æ–±–∞–≤–ª—è–µ—Ç —Ç–æ–≤–∞—Ä(—ã) –≤ —Å–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫ –≤ Google Tasks. –ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≥–æ–≤–æ—Ä–∏—Ç '–¥–æ–±–∞–≤—å –≤ –ø–æ–∫—É–ø–∫–∏', '–∫—É–ø–∏—Ç—å' –∏ —Ç.–ø.",
        "input_schema": {
            "type": "object",
            "properties": {
                "items": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "description": "–°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –ø–æ–∫—É–ø–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, ['–º–æ–ª–æ–∫–æ', '—Ö–ª–µ–±', '—è–π—Ü–∞'])"
                }
            },
            "required": ["items"]
        }
    },
    {
        "name": "get_tasks",
        "description": "–ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á –∏–∑ Google Tasks.",
        "input_schema": {
            "type": "object",
            "properties": {
                "task_list": {
                    "type": "string",
                    "enum": ["tasks", "shopping"],
                    "description": "–ö–∞–∫–æ–π —Å–ø–∏—Å–æ–∫ –ø–æ–ª—É—á–∏—Ç—å: 'tasks' (–æ–±—ã—á–Ω—ã–µ –∑–∞–¥–∞—á–∏) –∏–ª–∏ 'shopping' (–ø–æ–∫—É–ø–∫–∏)"
                },
                "show_completed": {
                    "type": "boolean",
                    "description": "–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ª–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é false)"
                }
            },
            "required": ["task_list"]
        }
    },
    {
        "name": "create_note",
        "description": "–°–æ–∑–¥–∞–µ—Ç –∑–∞–º–µ—Ç–∫—É –≤ Obsidian. –ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–∏—Ç '—Å–æ–∑–¥–∞—Ç—å –∑–∞–º–µ—Ç–∫—É', '–∑–∞–ø–∏—Å–∞—Ç—å –∏–¥–µ—é' –∏ —Ç.–ø.",
        "input_schema": {
            "type": "object",
            "properties": {
                "title": {
                    "type": "string",
                    "description": "–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ (–±—É–¥–µ—Ç –∏–º–µ–Ω–µ–º —Ñ–∞–π–ª–∞)"
                },
                "content": {
                    "type": "string",
                    "description": "–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∑–∞–º–µ—Ç–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Markdown"
                },
                "tags": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "description": "–¢–µ–≥–∏ –¥–ª—è –∑–∞–º–µ—Ç–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä ['–ø—Ä–æ–µ–∫—Ç', '–∏–¥–µ—è'])"
                }
            },
            "required": ["title", "content"]
        }
    },
    {
        "name": "search_notes",
        "description": "–ò—â–µ—Ç –∑–∞–º–µ—Ç–∫–∏ –≤ Obsidian –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º.",
        "input_schema": {
            "type": "object",
            "properties": {
                "query": {
                    "type": "string",
                    "description": "–ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å"
                },
                "limit": {
                    "type": "integer",
                    "description": "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5)"
                }
            },
            "required": ["query"]
        }
    }
]


def get_tool_by_name(tool_name: str) -> Dict[str, Any]:
    """
    –ü–æ–ª—É—á–∏—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –ø–æ –∏–º–µ–Ω–∏

    Args:
        tool_name: –ù–∞–∑–≤–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞

    Returns:
        –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –∏–ª–∏ None
    """
    for tool in TOOLS:
        if tool["name"] == tool_name:
            return tool
    return None


def get_all_tool_names() -> List[str]:
    """
    –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

    Returns:
        –°–ø–∏—Å–æ–∫ –Ω–∞–∑–≤–∞–Ω–∏–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
    """
    return [tool["name"] for tool in TOOLS]


# –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è Claude
SYSTEM_PROMPT = """–¢—ã - –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–≥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —É–ø—Ä–∞–≤–ª—è—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä–µ–º, –∑–∞–¥–∞—á–∞–º–∏ –∏ –∑–∞–º–µ—Ç–∫–∞–º–∏.

–¢–≤–æ–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
- **Google Calendar**: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä —Å–æ–±—ã—Ç–∏–π
- **Google Tasks**: —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏ –∏ —Å–ø–∏—Å–∫–æ–º –ø–æ–∫—É–ø–æ–∫
- **Obsidian**: —Å–æ–∑–¥–∞–Ω–∏–µ –∏ –ø–æ–∏—Å–∫ –∑–∞–º–µ—Ç–æ–∫

–í–∞–∂–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞:

1. **–ü–æ–Ω–∏–º–∞–Ω–∏–µ –¥–∞—Ç –∏ –≤—Ä–µ–º–µ–Ω–∏:**
   - –°–µ–≥–æ–¥–Ω—è: {today}
   - –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è: {current_time}
   - –í—Å–µ–≥–¥–∞ –ø—Ä–µ–æ–±—Ä–∞–∑—É–π –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞—Ç—ã ("–∑–∞–≤—Ç—Ä–∞", "–≤ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫", "—á–µ—Ä–µ–∑ –Ω–µ–¥–µ–ª—é") –≤ –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ –¥–∞—Ç—ã ISO 8601
   - –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —É–∫–∞–∑–∞–ª –≤—Ä–µ–º—è, –∏—Å–ø–æ–ª—å–∑—É–π —Ä–∞–∑—É–º–Ω–æ–µ –≤—Ä–µ–º—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, 12:00 –¥–ª—è –≤—Å—Ç—Ä–µ—á)

2. **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:**
   - –î–ª—è –í–°–ï–• –æ–ø–µ—Ä–∞—Ü–∏–π –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/–∏–∑–º–µ–Ω–µ–Ω–∏—è (–∫–∞–ª–µ–Ω–¥–∞—Ä—å, –∑–∞–¥–∞—á–∏, –∑–∞–º–µ—Ç–∫–∏) –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –∑–∞–ø—Ä–∞—à–∏–≤–∞–π –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
   - –§–æ—Ä–º—É–ª–∏—Ä—É–π –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —á–µ—Ç–∫–æ: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ —è –ø–æ–Ω—è–ª: [–¥–µ–π—Å—Ç–≤–∏–µ —Å –¥–µ—Ç–∞–ª—è–º–∏]?"
   - –ò—Å–ø–æ–ª—å–∑—É–π –ø–æ–ª–µ "requires_confirmation": true

3. **–°–ø–∏—Å–∫–∏ –ø–æ–∫—É–ø–æ–∫ vs –ó–∞–¥–∞—á–∏:**
   - –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≥–æ–≤–æ—Ä–∏—Ç "–∫—É–ø–∏—Ç—å", "–≤ –ø–æ–∫—É–ø–∫–∏", "–¥–æ–±–∞–≤—å –≤ –º–∞–≥–∞–∑–∏–Ω" ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π add_shopping_item
   - –î–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π add_task

4. **–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–æ–≤:**
   - –ë—É–¥—å –∫—Ä–∞—Ç–∫–∏–º –∏ –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–º
   - –ò—Å–ø–æ–ª—å–∑—É–π —ç–º–æ–¥–∑–∏ –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏ (üìÖ –¥–ª—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è, ‚úÖ –¥–ª—è –∑–∞–¥–∞—á, üìù –¥–ª—è –∑–∞–º–µ—Ç–æ–∫)
   - –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ - –∑–∞–¥–∞–≤–∞–π —É—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã

5. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
   - –ï—Å–ª–∏ –Ω–µ –º–æ–∂–µ—à—å –ø–æ–Ω—è—Ç—å –∑–∞–ø—Ä–æ—Å - –≤–µ–∂–ª–∏–≤–æ –ø–æ–ø—Ä–æ—Å–∏ —É—Ç–æ—á–Ω–∏—Ç—å
   - –ï—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ - —Å–ø—Ä–æ—Å–∏ —á—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω—É–∂–Ω–æ

–ü—Ä–∏–º–µ—Ä—ã:
- "–ó–∞–ø–∏—à–∏ –Ω–∞ –∑–∞–≤—Ç—Ä–∞ –≤ 15:00 –≤—Å—Ç—Ä–µ—á—É —Å –≤—Ä–∞—á–æ–º" ‚Üí add_calendar_event —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º
- "–ß—Ç–æ —É –º–µ–Ω—è –Ω–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ?" ‚Üí get_calendar_events
- "–î–æ–±–∞–≤—å –≤ –ø–æ–∫—É–ø–∫–∏ –º–æ–ª–æ–∫–æ –∏ —Ö–ª–µ–±" ‚Üí add_shopping_item
- "–°–æ–∑–¥–∞–π –∑–∞–º–µ—Ç–∫—É –ø—Ä–æ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç" ‚Üí create_note —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º

–í—Å–µ–≥–¥–∞ —Å—Ç–∞—Ä–∞–π—Å—è –ø–æ–Ω—è—Ç—å –Ω–∞–º–µ—Ä–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø–æ–º–æ—á—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ."""


def get_system_prompt(today: str, current_time: str) -> str:
    """
    –ü–æ–ª—É—á–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç —Å –ø–æ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–º–∏ –¥–∞—Ç–æ–π –∏ –≤—Ä–µ–º–µ–Ω–µ–º

    Args:
        today: –¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM-DD
        current_time: –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ HH:MM

    Returns:
        –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç
    """
    return SYSTEM_PROMPT.format(today=today, current_time=current_time)
