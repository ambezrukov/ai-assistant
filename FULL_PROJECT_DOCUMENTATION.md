# AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç v1.0 - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞

**–î–∞—Ç–∞:** 2026-01-13
**–í–µ—Ä—Å–∏—è:** 1.0 (–ø–µ—Ä–≤—ã–π —Ä–µ–ª–∏–∑)
**–°—Ç–∞—Ç—É—Å:** üöß –ì–æ—Ç–æ–≤ –∫ –ø–µ—Ä–≤–æ–º—É –∑–∞–ø—É—Å–∫—É –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

---

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞](#–æ–±–∑–æ—Ä-–ø—Ä–æ–µ–∫—Ç–∞)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-—Å–∏—Å—Ç–µ–º—ã)
3. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
4. [–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫](#—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π-—Å—Ç–µ–∫)
5. [–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã](#–æ—Å–Ω–æ–≤–Ω—ã–µ-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)
6. [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)
7. [API Reference](#api-reference)
8. [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
9. [–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö](#–±–∞–∑–∞-–¥–∞–Ω–Ω—ã—Ö)
10. [–†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ](#—Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ)
11. [–ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤](#–∏—Å—Ö–æ–¥–Ω—ã–π-–∫–æ–¥-–≤—Å–µ—Ö-—Ñ–∞–π–ª–æ–≤)

---

## –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç v2.0 - —ç—Ç–æ –ª–∏—á–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ —Å –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–º —è–∑—ã–∫–æ–≤—ã–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º, –∫–æ—Ç–æ—Ä—ã–π:

- –£–ø—Ä–∞–≤–ª—è–µ—Ç –∫–∞–ª–µ–Ω–¥–∞—Ä—ë–º (Google Calendar)
- –£–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–¥–∞—á–∞–º–∏ –∏ –ø–æ–∫—É–ø–∫–∞–º–∏ (Google Tasks)
- –°–æ–∑–¥–∞—ë—Ç –∏ –∏—â–µ—Ç –∑–∞–º–µ—Ç–∫–∏ (Obsidian)
- –†–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ Telegram –±–æ—Ç
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≥–æ–ª–æ—Å–æ–≤—É—é –∞–∫—Ç–∏–≤–∞—Ü–∏—é —á–µ—Ä–µ–∑ Tasker (Android)
- –†–∞—Å–ø–æ–∑–Ω–∞—ë—Ç —Ä–µ—á—å —á–µ—Ä–µ–∑ Whisper API
- –û–∑–≤—É—á–∏–≤–∞–µ—Ç –æ—Ç–≤–µ—Ç—ã —á–µ—Ä–µ–∑ gTTS

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

1. **Telegram –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:**
   - –¢–µ–∫—Å—Ç–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã –Ω–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º —è–∑—ã–∫–µ
   - –ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ–º
   - –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π –¥–ª—è –≤–∞–∂–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
   - –ò—Å—Ç–æ—Ä–∏—è —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

2. **REST API –¥–ª—è Tasker:**
   - –ì–æ–ª–æ—Å–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã —Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞
   - –ê–∫—Ç–∏–≤–∞—Ü–∏—è –¥–ª–∏–Ω–Ω—ã–º –Ω–∞–∂–∞—Ç–∏–µ–º –∫–Ω–æ–ø–∫–∏ –ø–∏—Ç–∞–Ω–∏—è
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–∑–≤—É—á–∏–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤
   - –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π —á–µ—Ä–µ–∑ –¥–∏–∞–ª–æ–≥–∏

3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:**
   - Google Calendar (—Å–æ–±—ã—Ç–∏—è)
   - Google Tasks (–∑–∞–¥–∞—á–∏ –∏ –ø–æ–∫—É–ø–∫–∏)
   - Obsidian (–∑–∞–º–µ—Ç–∫–∏ –≤ Markdown)
   - OpenAI Whisper (—Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏)
   - Google TTS (–æ–∑–≤—É—á–∏–≤–∞–Ω–∏–µ)

4. **–ì–∏–±—Ä–∏–¥–Ω–∞—è LLM –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (NEW –≤ v2.1):**
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Claude API –∏ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ Ollama
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –ø–æ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–∞
   - –õ–µ–≥–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏
   - Fallback –º–µ—Ö–∞–Ω–∏–∑–º –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

5. **–ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∞—è –ø–∞–º—è—Ç—å (NEW –≤ v2.1):**
   - –ò–∑—É—á–µ–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –ê–Ω–∞–ª–∏–∑ —á–∞—Å—Ç—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π
   - –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ-–∑–∞–≤–∏—Å–∏–º—ã–µ –æ—Ç–≤–µ—Ç—ã
   - –£–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–î–æ–±–∞–≤—å –≤—Å—Ç—Ä–µ—á—É —Å –≤—Ä–∞—á–æ–º –∑–∞–≤—Ç—Ä–∞ –≤ 15:00"
–ë–æ—Ç: "üìÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ —è –ø–æ–Ω—è–ª: –¥–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ '–í—Å—Ç—Ä–µ—á–∞ —Å –≤—Ä–∞—á–æ–º' –Ω–∞ 09 —è–Ω–≤–∞—Ä—è –≤ 15:00?"
[–ö–Ω–æ–ø–∫–∏: –î–∞ | –ù–µ—Ç]
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: [–ù–∞–∂–∏–º–∞–µ—Ç "–î–∞"]
–ë–æ—Ç: "‚úÖ –°–æ–±—ã—Ç–∏–µ '–í—Å—Ç—Ä–µ—á–∞ —Å –≤—Ä–∞—á–æ–º' –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä—å"
```

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ß—Ç–æ —É –º–µ–Ω—è —Å–µ–≥–æ–¥–Ω—è?"
–ë–æ—Ç: "üìÖ –ù–∞–π–¥–µ–Ω–æ —Å–æ–±—ã—Ç–∏–π: 3
‚Ä¢ –í—Å—Ç—Ä–µ—á–∞ —Å –∫–æ–º–∞–Ω–¥–æ–π (09.01 –≤ 10:00)
‚Ä¢ –û–±–µ–¥ —Å –∫–ª–∏–µ–Ω—Ç–æ–º (09.01 –≤ 13:00)
‚Ä¢ –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ (09.01 –≤ 18:00)"
```

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### –û–±—â–∞—è —Å—Ö–µ–º–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚îÇ                                   ‚îÇ
             ‚îÇ Telegram                          ‚îÇ Tasker (Android)
             ‚îÇ                                   ‚îÇ
             v                                   v
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Telegram Bot API     ‚îÇ          ‚îÇ      REST API (FastAPI)   ‚îÇ
‚îÇ  (python-telegram-bot) ‚îÇ          ‚îÇ  + Bearer Auth            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚îÇ                                   ‚îÇ
             ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
                            v
             ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
             ‚îÇ   Claude Agent           ‚îÇ
             ‚îÇ   (Function Calling)     ‚îÇ
             ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
          ‚îÇ                 ‚îÇ                 ‚îÇ
          v                 v                 v
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Google Calendar ‚îÇ  ‚îÇ Google Tasks ‚îÇ  ‚îÇ   Obsidian   ‚îÇ
‚îÇ   (OAuth 2.0)   ‚îÇ  ‚îÇ  (OAuth 2.0) ‚îÇ  ‚îÇ (Filesystem) ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã                   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Whisper API    ‚îÇ      gTTS       ‚îÇ   SQLite Database       ‚îÇ
‚îÇ  (Speech-to-Text)‚îÇ (Text-to-Speech)‚îÇ   (–ò—Å—Ç–æ—Ä–∏—è, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞)‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
ai-assistant/
‚îÇ
‚îú‚îÄ‚îÄ main.py                    # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (multiprocessing)
‚îÇ
‚îú‚îÄ‚îÄ bot/                       # Telegram –±–æ—Ç
‚îÇ   ‚îú‚îÄ‚îÄ telegram_bot.py       # –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –±–æ—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ message_handler.py    # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ voice_handler.py      # –û–±—Ä–∞–±–æ—Ç–∫–∞ –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ
‚îú‚îÄ‚îÄ api/                       # REST API
‚îÇ   ‚îú‚îÄ‚îÄ app.py                # FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ routes/               # Endpoints
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ voice.py          # POST /api/v1/voice-command
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ text.py           # POST /api/v1/text-command
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ confirm.py        # POST /api/v1/confirm
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tts.py            # GET /api/v1/tts/{filename}
‚îÇ   ‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.py           # Bearer token –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ models.py             # Pydantic –º–æ–¥–µ–ª–∏
‚îÇ
‚îú‚îÄ‚îÄ agent/                     # Claude AI –∞–≥–µ–Ω—Ç
‚îÇ   ‚îú‚îÄ‚îÄ claude_agent.py       # –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –∞–≥–µ–Ω—Ç–∞
‚îÇ   ‚îî‚îÄ‚îÄ tools.py              # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
‚îÇ
‚îú‚îÄ‚îÄ integrations/              # –í–Ω–µ—à–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ google_calendar.py    # Google Calendar API
‚îÇ   ‚îú‚îÄ‚îÄ google_tasks.py       # Google Tasks API
‚îÇ   ‚îú‚îÄ‚îÄ obsidian.py           # Obsidian (filesystem)
‚îÇ   ‚îú‚îÄ‚îÄ whisper.py            # OpenAI Whisper API
‚îÇ   ‚îî‚îÄ‚îÄ tts.py                # Google TTS
‚îÇ
‚îî‚îÄ‚îÄ utils/                     # –£—Ç–∏–ª–∏—Ç—ã
    ‚îú‚îÄ‚îÄ config.py             # –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
    ‚îú‚îÄ‚îÄ database.py           # SQLite (async)
    ‚îú‚îÄ‚îÄ logger.py             # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
    ‚îî‚îÄ‚îÄ cache.py              # –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ TTS
```

### –ü–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞

#### –ß–µ—Ä–µ–∑ Telegram:

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
   ‚Üì
2. telegram_bot.py –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
   ‚Üì
3. message_handler.py –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø (—Ç–µ–∫—Å—Ç/–≥–æ–ª–æ—Å)
   ‚Üì
4. –ï—Å–ª–∏ –≥–æ–ª–æ—Å ‚Üí voice_handler.py ‚Üí Whisper API ‚Üí —Ç–µ–∫—Å—Ç
   ‚Üì
5. claude_agent.py –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —á–µ—Ä–µ–∑ Function Calling
   ‚Üì
6. Claude –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω—É–∂–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç (tool)
   ‚Üì
7. _execute_tool() –≤—ã–∑—ã–≤–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é
   ‚Üì
8. –ï—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å inline –∫–Ω–æ–ø–∫–∏
   ‚Üì
9. –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è ‚Üí –≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ
   ‚Üì
10. –í–µ—Ä–Ω—É—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
```

#### –ß–µ—Ä–µ–∑ Tasker API:

```
1. –î–ª–∏–Ω–Ω–æ–µ –Ω–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ –ø–∏—Ç–∞–Ω–∏—è –Ω–∞ Android
   ‚Üì
2. Tasker –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≥–æ–ª–æ—Å (5 —Å–µ–∫)
   ‚Üì
3. POST /api/v1/voice-command (multipart/form-data)
   ‚Üì
4. auth.py –ø—Ä–æ–≤–µ—Ä—è–µ—Ç Bearer token
   ‚Üì
5. voice.py ‚Üí Whisper API ‚Üí —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ
   ‚Üì
6. claude_agent.py –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å
   ‚Üì
7. –ï—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç confirmation_id
   ‚Üì
8. tts.py –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∞—É–¥–∏–æ –æ—Ç–≤–µ—Ç (–∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ)
   ‚Üì
9. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON —Å audio_url
   ‚Üì
10. Tasker —Å–∫–∞—á–∏–≤–∞–µ—Ç –∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –∞—É–¥–∏–æ
```

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

### –î–µ—Ä–µ–≤–æ —Ñ–∞–π–ª–æ–≤

```
ai-assistant/
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ PROGRESS.md
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ config.yaml.example
‚îú‚îÄ‚îÄ .env.example
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ main.py
‚îÇ
‚îú‚îÄ‚îÄ agent/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ claude_agent.py        (593 —Å—Ç—Ä–æ–∫–∏) - –æ—Å–Ω–æ–≤–Ω–æ–π –∞–≥–µ–Ω—Ç —Å Ollama
‚îÇ   ‚îú‚îÄ‚îÄ tools.py                (237 —Å—Ç—Ä–æ–∫) - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ llm_provider.py         (380 —Å—Ç—Ä–æ–∫) - NEW: –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ memory.py               (310 —Å—Ç—Ä–æ–∫) - NEW: –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∞—è –ø–∞–º—è—Ç—å
‚îÇ
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ app.py                  (156 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îú‚îÄ‚îÄ models.py               (89 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.py             (72 —Å—Ç—Ä–æ–∫–∏)
‚îÇ   ‚îî‚îÄ‚îÄ routes/
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îú‚îÄ‚îÄ confirm.py          (148 —Å—Ç—Ä–æ–∫)
‚îÇ       ‚îú‚îÄ‚îÄ text.py             (142 —Å—Ç—Ä–æ–∫–∏)
‚îÇ       ‚îú‚îÄ‚îÄ tts.py              (96 —Å—Ç—Ä–æ–∫)
‚îÇ       ‚îî‚îÄ‚îÄ voice.py            (181 —Å—Ç—Ä–æ–∫–∞)
‚îÇ
‚îú‚îÄ‚îÄ bot/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ telegram_bot.py         (245 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îú‚îÄ‚îÄ message_handler.py      (243 —Å—Ç—Ä–æ–∫–∏)
‚îÇ   ‚îî‚îÄ‚îÄ voice_handler.py        (189 —Å—Ç—Ä–æ–∫)
‚îÇ
‚îú‚îÄ‚îÄ integrations/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ google_calendar.py      (340 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îú‚îÄ‚îÄ google_tasks.py         (367 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îú‚îÄ‚îÄ obsidian.py             (354 —Å—Ç—Ä–æ–∫–∏)
‚îÇ   ‚îú‚îÄ‚îÄ tts.py                  (173 —Å—Ç—Ä–æ–∫–∏)
‚îÇ   ‚îî‚îÄ‚îÄ whisper.py              (121 —Å—Ç—Ä–æ–∫–∞)
‚îÇ
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ cache.py                (134 —Å—Ç—Ä–æ–∫–∏)
‚îÇ   ‚îú‚îÄ‚îÄ config.py               (98 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îú‚îÄ‚îÄ database.py             (312 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îî‚îÄ‚îÄ logger.py               (97 —Å—Ç—Ä–æ–∫)
‚îÇ
‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îú‚îÄ‚îÄ setup.md                (~800 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îú‚îÄ‚îÄ deployment.md           (~1200 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îú‚îÄ‚îÄ usage.md                (~900 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îî‚îÄ‚îÄ tasker_setup.md         (~700 —Å—Ç—Ä–æ–∫)
‚îÇ
‚îú‚îÄ‚îÄ nginx/
‚îÇ   ‚îú‚îÄ‚îÄ ai_assistant.conf       (~130 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îî‚îÄ‚îÄ setup_https.md          (~500 —Å—Ç—Ä–æ–∫)
‚îÇ
‚îú‚îÄ‚îÄ systemd/
‚îÇ   ‚îú‚îÄ‚îÄ ai-assistant-bot.service
‚îÇ   ‚îî‚îÄ‚îÄ ai-assistant-api.service
‚îÇ
‚îú‚îÄ‚îÄ tasker/
‚îÇ   ‚îî‚îÄ‚îÄ AI_Assistant.prj.xml    (~300 —Å—Ç—Ä–æ–∫)
‚îÇ
‚îú‚îÄ‚îÄ credentials/                 (—Å–æ–∑–¥–∞—ë—Ç—Å—è –ø—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ)
‚îÇ   ‚îú‚îÄ‚îÄ google_calendar_credentials.json
‚îÇ   ‚îî‚îÄ‚îÄ google_tasks_credentials.json
‚îÇ
‚îú‚îÄ‚îÄ data/                        (—Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îÇ   ‚îú‚îÄ‚îÄ ai_assistant.db
‚îÇ   ‚îú‚îÄ‚îÄ google_calendar_token.json
‚îÇ   ‚îî‚îÄ‚îÄ google_tasks_token.json
‚îÇ
‚îú‚îÄ‚îÄ logs/                        (—Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îÇ   ‚îî‚îÄ‚îÄ app.log
‚îÇ
‚îî‚îÄ‚îÄ cache/                       (—Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
    ‚îî‚îÄ‚îÄ *.mp3                    (TTS —Ñ–∞–π–ª—ã)
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤:** 40+
- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞ Python:** ~5000
- **–°—Ç—Ä–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:** ~3600
- **–°—Ç—Ä–æ–∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:** ~500

---

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### Backend

| –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –í–µ—Ä—Å–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------------|--------|------------|
| Python | 3.11+ | –û—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫ |
| FastAPI | 0.104+ | REST API framework |
| python-telegram-bot | 20.0+ | Telegram Bot API |
| anthropic | latest | Claude AI SDK |
| openai | 1.3+ | Whisper API |
| google-api-python-client | latest | Google APIs |
| gTTS | latest | Text-to-Speech |
| aiosqlite | 0.19+ | Async SQLite |
| pydantic | 2.0+ | Data validation |
| uvicorn | latest | ASGI server |
| pyyaml | latest | Config parsing |

### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è |
|-----------|------------|
| –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö | SQLite |
| Web —Å–µ—Ä–≤–µ—Ä | Nginx |
| HTTPS | Let's Encrypt (Certbot) |
| Process manager | systemd |
| –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ | JSON + rotating files |
| –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ | Filesystem (MD5) |

### –í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã

| –°–µ—Ä–≤–∏—Å | API | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|--------|-----|------------|
| Anthropic Claude | REST API | Natural Language Understanding |
| OpenAI Whisper | REST API | Speech-to-Text |
| Google Calendar | REST API (OAuth 2.0) | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è–º–∏ |
| Google Tasks | REST API (OAuth 2.0) | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏ |
| Telegram | Bot API | Telegram –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å |
| Google TTS | gTTS library | Text-to-Speech |

---

## –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. main.py - –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ó–∞–ø—É—Å–∫ Telegram –±–æ—Ç–∞ –∏ API –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–∞—Ö

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- Multiprocessing –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
- Graceful shutdown
- –ê—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ (--bot-only, --api-only)

**–ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
```python
def run_telegram_bot()  # –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
def run_api_server()    # –ó–∞–ø—É—Å–∫ API
def main()              # –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
```

### 2. Claude Agent (agent/claude_agent.py)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ Claude AI —Å Function Calling

**–ö–ª–∞—Å—Å:** `ClaudeAgent`

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**

```python
async def process_message(
    message: str,
    user_id: str,
    conversation_history: Optional[List] = None
) -> Dict[str, Any]:
    """
    –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

    Returns:
        {
            "action": "confirm" | "executed",
            "action_type": str,
            "response_text": str,
            "confirmation_id": str (optional),
            "tokens_used": int
        }
    """
```

**Function Calling Tools:**

1. **add_calendar_event** - –î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä—å
2. **get_calendar_events** - –ü–æ–ª—É—á–∏—Ç—å —Å–æ–±—ã—Ç–∏—è
3. **add_task** - –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É
4. **add_shopping_item** - –î–æ–±–∞–≤–∏—Ç—å –ø–æ–∫—É–ø–∫–∏
5. **get_tasks** - –ü–æ–ª—É—á–∏—Ç—å –∑–∞–¥–∞—á–∏
6. **create_note** - –°–æ–∑–¥–∞—Ç—å –∑–∞–º–µ—Ç–∫—É
7. **search_notes** - –ù–∞–π—Ç–∏ –∑–∞–º–µ—Ç–∫–∏

**–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π:**

–î–µ–π—Å—Ç–≤–∏—è, —Ç—Ä–µ–±—É—é—â–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:
- `add_calendar_event`
- `add_task`
- `add_shopping_item`
- `create_note`

–î–µ–π—Å—Ç–≤–∏—è –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:
- `get_calendar_events`
- `get_tasks`
- `search_notes`

### 3. Telegram Bot (bot/)

#### telegram_bot.py

**–ö–ª–∞—Å—Å:** `TelegramBot`

**–ö–æ–º–∞–Ω–¥—ã:**
- `/start` - –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
- `/help` - –°–ø—Ä–∞–≤–∫–∞
- `/stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- `/cancel` - –û—Ç–º–µ–Ω–∞

**–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:**
- `MessageHandler` - —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- `VoiceHandler` - –≥–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- `CallbackQueryHandler` - inline –∫–Ω–æ–ø–∫–∏

#### message_handler.py

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Claude Agent
- –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π —Å inline –∫–Ω–æ–ø–∫–∞–º–∏
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –≤ –ë–î

**Inline –∫–Ω–æ–ø–∫–∏ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:**
```python
keyboard = [
    [
        InlineKeyboardButton("‚úì –î–∞", callback_data=f"confirm:{confirmation_id}"),
        InlineKeyboardButton("‚úó –ù–µ—Ç", callback_data=f"cancel:{confirmation_id}")
    ]
]
```

#### voice_handler.py

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è OGG ‚Üí WAV/M4A
- –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Whisper API
- –ì–æ–ª–æ—Å–æ–≤–æ–π –æ—Ç–≤–µ—Ç —á–µ—Ä–µ–∑ gTTS

### 4. REST API (api/)

#### app.py

**FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**

**Endpoints:**
- `POST /api/v1/voice-command` - –ì–æ–ª–æ—Å–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞
- `POST /api/v1/text-command` - –¢–µ–∫—Å—Ç–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞
- `POST /api/v1/confirm` - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è
- `GET /api/v1/tts/{filename}` - TTS –∞—É–¥–∏–æ —Ñ–∞–π–ª
- `GET /api/v1/health` - Health check
- `GET /docs` - Swagger UI

**Middleware:**
- CORS
- Logging
- Error handling
- Bearer token authentication

#### models.py

**Pydantic –º–æ–¥–µ–ª–∏:**

```python
class VoiceCommandRequest(BaseModel):
    user_id: str
    # + audio file (multipart)

class TextCommandRequest(BaseModel):
    text: str
    user_id: str

class ConfirmRequest(BaseModel):
    confirmation_id: str
    user_id: str
    confirmed: bool

class CommandResponse(BaseModel):
    message: str
    action: str
    audio_url: Optional[str]
    confirmation_id: Optional[str]
```

#### middleware/auth.py

**Bearer Token Authentication:**

```python
async def verify_token(
    authorization: str = Header(...)
):
    if not authorization.startswith("Bearer "):
        raise HTTPException(401)

    token = authorization.replace("Bearer ", "")
    if token != EXPECTED_TOKEN:
        raise HTTPException(401)
```

### 5. Database (utils/database.py)

**–ö–ª–∞—Å—Å:** `Database`

**–°—Ö–µ–º–∞ —Ç–∞–±–ª–∏—Ü:**

```sql
-- –¢–∞–±–ª–∏—Ü–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
CREATE TABLE messages (
    id INTEGER PRIMARY KEY,
    user_id TEXT NOT NULL,
    role TEXT NOT NULL,  -- 'user' –∏–ª–∏ 'assistant'
    content TEXT NOT NULL,
    session_id TEXT,
    timestamp DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- –¢–∞–±–ª–∏—Ü–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π
CREATE TABLE confirmations (
    id TEXT PRIMARY KEY,  -- UUID
    user_id TEXT NOT NULL,
    action_type TEXT NOT NULL,
    action_data TEXT NOT NULL,  -- JSON
    confirmation_text TEXT NOT NULL,
    status TEXT DEFAULT 'pending',  -- 'pending', 'confirmed', 'cancelled'
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME
);

-- –¢–∞–±–ª–∏—Ü–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
CREATE TABLE usage_stats (
    id INTEGER PRIMARY KEY,
    user_id TEXT NOT NULL,
    interface TEXT NOT NULL,  -- 'telegram' –∏–ª–∏ 'api'
    action_type TEXT,
    tokens_used INTEGER DEFAULT 0,
    timestamp DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**

```python
async def save_message(user_id, role, content, session_id=None)
async def get_message_history(user_id, limit=50, session_id=None)
async def save_confirmation(confirmation_id, user_id, action_type, action_data, confirmation_text)
async def get_confirmation(confirmation_id)
async def update_confirmation_status(confirmation_id, status)
async def save_usage_stats(user_id, interface, action_type, tokens_used)
async def get_usage_stats(user_id)
```

### 6. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (utils/logger.py)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**

```python
# JSON —Ñ–æ—Ä–º–∞—Ç –≤ —Ñ–∞–π–ª
{
    "timestamp": "2025-01-08T15:30:00",
    "level": "INFO",
    "module": "claude_agent",
    "message": "–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç user123",
    "extra": {...}
}

# –ß–µ–ª–æ–≤–µ–∫–æ-—á–∏—Ç–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç –≤ –∫–æ–Ω—Å–æ–ª—å
2025-01-08 15:30:00 - INFO - claude_agent - –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
```

**–†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤:**
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 10 MB
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—ç–∫–∞–ø–æ–≤: 5
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## –ù–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã v2.1

### 7. LLM Provider (agent/llm_provider.py)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏

**–ö–ª–∞—Å—Å—ã:**

```python
class LLMProvider(ABC):
    """–ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞"""

    async def generate(messages, system_prompt, tools, ...) -> LLMResponse
    def is_available() -> bool
    def get_name() -> str
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

1. **ClaudeProvider** - –¥–ª—è Claude API (Anthropic)
   - –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ function calling
   - –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ (Haiku/Sonnet)
   - –ü–æ–¥—Å—á—ë—Ç —Ç–æ–∫–µ–Ω–æ–≤

2. **OllamaProvider** - –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ Ollama
   - –†–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ chat API
   - –ü—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω—ã–π –ø–æ–¥—Å—á—ë—Ç —Ç–æ–∫–µ–Ω–æ–≤

3. **HybridLLMRouter** - —É–º–Ω—ã–π —Ä–æ—É—Ç–µ—Ä
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –ø–æ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
   - Fallback –º–µ—Ö–∞–Ω–∏–∑–º –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
   - –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ—Å—Ç—ã—Ö/—Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

```python
from agent.llm_provider import create_llm_router

router = create_llm_router(config)
response = await router.generate(
    messages=[{"role": "user", "content": "–î–æ–±–∞–≤—å –º–æ–ª–æ–∫–æ –≤ –ø–æ–∫—É–ø–∫–∏"}],
    system_prompt="–¢—ã - –ª–∏—á–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç",
    tools=TOOLS
)

print(response.text)
print(f"–ú–æ–¥–µ–ª—å: {response.model_used}")
print(f"–¢–æ–∫–µ–Ω–æ–≤: {response.tokens_used}")
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

- ‚úÖ –õ–µ–≥–∫–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É Claude –∏ Ollama (–æ–¥–∏–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä –≤ –∫–æ–Ω—Ñ–∏–≥–µ)
- ‚úÖ –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã (GPT-4, Gemini) –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Å—Ç–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö
- ‚úÖ –ï–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤—Å–µ—Ö LLM

---

### 8. Memory System (agent/memory.py)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∞—è –ø–∞–º—è—Ç—å –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ö–ª–∞—Å—Å—ã:**

```python
class UserMemory:
    """–ü–∞–º—è—Ç—å –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""

    async def get_context_summary(days=30) -> Dict
    async def get_frequent_shopping_items(limit=10) -> List[str]
    async def get_context_prompt() -> str
```

```python
class MemoryManager:
    """–ì–ª–æ–±–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –ø–∞–º—è—Ç–∏"""

    def get_user_memory(user_id) -> UserMemory
    async def get_enriched_system_prompt(base_prompt, user_id) -> str
    async def save_action_pattern(user_id, action_type, action_data)
```

**–ß—Ç–æ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è:**

1. **–ß–∞—Å—Ç—ã–µ –¥–µ–π—Å—Ç–≤–∏—è** - –∫–∞–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–ø–æ–ª–Ω—è–µ—Ç —á–∞—â–µ –≤—Å–µ–≥–æ
2. **–ß–∞—Å—Ç—ã–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞** - –æ —á—ë–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–±—ã—á–Ω–æ —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç
3. **–ß–∞—Å—ã –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏** - –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–±—ã—á–Ω–æ –∞–∫—Ç–∏–≤–µ–Ω
4. **–ß–∞—Å—Ç—ã–µ –ø–æ–∫—É–ø–∫–∏** - –∫–∞–∫–∏–µ —Ç–æ–≤–∞—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–∫—É–ø–∞–µ—Ç —Ä–µ–≥—É–ª—è—Ä–Ω–æ

**–ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞:**

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞–ª —Å –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º 147 —Ä–∞–∑ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü.
–ß–∞—Å—Ç—ã–µ –¥–µ–π—Å—Ç–≤–∏—è: add_shopping_item, get_calendar_events, add_task.
–ß–∞—Å—Ç–æ —É–ø–æ–º–∏–Ω–∞–µ–º—ã–µ —Ç–µ–º—ã: –º–æ–ª–æ–∫–æ, –≤—Å—Ç—Ä–µ—á–∞, –∑–∞–¥–∞—á–∏, —Å–ø–æ—Ä—Ç–∑–∞–ª, –≤—Ä–∞—á.
–ß–∞—Å—Ç–æ –ø–æ–∫—É–ø–∞–µ–º—ã–µ —Ç–æ–≤–∞—Ä—ã: –º–æ–ª–æ–∫–æ, —Ö–ª–µ–±, —è–π—Ü–∞, —Å—ã—Ä.
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–±—ã—á–Ω–æ –∞–∫—Ç–∏–≤–µ–Ω —É—Ç—Ä–æ–º –∏ –≤–µ—á–µ—Ä–æ–º.
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

- ‚úÖ –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç "–ø–æ–º–Ω–∏—Ç" –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –ë–æ–ª–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–∫—É–ø–æ–∫)
- ‚úÖ –õ—É—á—à–µ –ø–æ–Ω–∏–º–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ —É–ª—É—á—à–∞–µ—Ç—Å—è —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

```python
from agent.memory import get_memory_manager

memory = get_memory_manager()

# –û–±–æ–≥–∞—Ç–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
enriched_prompt = await memory.get_enriched_system_prompt(
    base_prompt="–¢—ã - –ª–∏—á–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç",
    user_id="user123"
)

# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω –¥–µ–π—Å—Ç–≤–∏—è
await memory.save_action_pattern(
    user_id="user123",
    action_type="add_shopping_item",
    action_data={"items": ["–º–æ–ª–æ–∫–æ", "—Ö–ª–µ–±"]}
)

# –ü–æ–ª—É—á–∏—Ç—å –ø–∞–º—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
user_memory = memory.get_user_memory("user123")
frequent_items = await user_memory.get_frequent_shopping_items()
print(f"–ß–∞—Å—Ç—ã–µ –ø–æ–∫—É–ø–∫–∏: {frequent_items}")
```

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### 1. Google Calendar (integrations/google_calendar.py)

**–ö–ª–∞—Å—Å:** `GoogleCalendar`

**–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:** OAuth 2.0

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**

```python
def add_event(
    summary: str,
    start_time: str,  # ISO 8601
    end_time: str = None,
    description: str = None,
    location: str = None
) -> Dict:
    """–î–æ–±–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä—å"""

def get_events(
    time_min: str,
    time_max: str,
    max_results: int = 10
) -> List[Dict]:
    """–ü–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –∑–∞ –ø–µ—Ä–∏–æ–¥"""

def update_event(event_id: str, ...) -> Dict:
    """–û–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ"""

def delete_event(event_id: str) -> bool:
    """–£–¥–∞–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ"""
```

**–§–æ—Ä–º–∞—Ç –≤—Ä–µ–º–µ–Ω–∏:**
```python
# –ü—Ä–∏–º–µ—Ä
start_time = "2025-01-09T15:00:00"  # ISO 8601
timezone = "Europe/Moscow"
```

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```python
from integrations.google_calendar import get_calendar

calendar = get_calendar()
event = calendar.add_event(
    summary="–í—Å—Ç—Ä–µ—á–∞ —Å –≤—Ä–∞—á–æ–º",
    start_time="2025-01-09T15:00:00",
    description="–ï–∂–µ–≥–æ–¥–Ω—ã–π –æ—Å–º–æ—Ç—Ä"
)
```

### 2. Google Tasks (integrations/google_tasks.py)

**–ö–ª–∞—Å—Å:** `GoogleTasks`

**–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:** OAuth 2.0

**–°–ø–∏—Å–∫–∏ –∑–∞–¥–∞—á:**
- –û—Å–Ω–æ–≤–Ω–æ–π —Å–ø–∏—Å–æ–∫ (tasks)
- –°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫ (shopping)

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**

```python
def add_task(
    title: str,
    notes: str = None,
    due_date: str = None
) -> Dict:
    """–î–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–¥–∞—á—É"""

def add_shopping_items(items: List[str]) -> Dict:
    """–î–æ–±–∞–≤–ª—è–µ—Ç —Ç–æ–≤–∞—Ä—ã –≤ —Å–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫"""

def get_tasks(
    show_completed: bool = False
) -> List[Dict]:
    """–ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á"""

def complete_task(task_id: str) -> bool:
    """–û—Ç–º–µ—á–∞–µ—Ç –∑–∞–¥–∞—á—É –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π"""

def delete_task(task_id: str) -> bool:
    """–£–¥–∞–ª—è–µ—Ç –∑–∞–¥–∞—á—É"""
```

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```python
from integrations.google_tasks import get_tasks

tasks = get_tasks()

# –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É
tasks.add_task(
    title="–ü–æ–∑–≤–æ–Ω–∏—Ç—å –≤ –±–∞–Ω–∫",
    due_date="2025-01-10T18:00:00Z"
)

# –î–æ–±–∞–≤–∏—Ç—å –ø–æ–∫—É–ø–∫–∏
tasks.add_shopping_items([
    "–º–æ–ª–æ–∫–æ",
    "—Ö–ª–µ–±",
    "—è–π—Ü–∞"
])
```

### 3. Obsidian (integrations/obsidian.py)

**–ö–ª–∞—Å—Å:** `ObsidianVault`

**–ú–µ—Ç–æ–¥:** Filesystem (–ø—Ä—è–º–∞—è —Ä–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏)

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**

```python
def create_note(
    title: str,
    content: str,
    tags: List[str] = None,
    folder: str = None
) -> Dict:
    """–°–æ–∑–¥–∞—ë—Ç –∑–∞–º–µ—Ç–∫—É –≤ Markdown"""

def search_notes(
    query: str,
    limit: int = 5
) -> List[Dict]:
    """–ò—â–µ—Ç –∑–∞–º–µ—Ç–∫–∏ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º"""

def read_note(file_path: str) -> Dict:
    """–ß–∏—Ç–∞–µ—Ç –∑–∞–º–µ—Ç–∫—É"""

def update_note(file_path: str, content: str) -> Dict:
    """–û–±–Ω–æ–≤–ª—è–µ—Ç –∑–∞–º–µ—Ç–∫—É"""
```

**–§–æ—Ä–º–∞—Ç –∑–∞–º–µ—Ç–æ–∫ (Markdown + frontmatter):**

```markdown
---
title: –ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏
created: 2025-01-08T15:30:00
tags: [–∏–¥–µ—è, –ø—Ä–æ–µ–∫—Ç]
---

# –ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∑–∞–º–µ—Ç–∫–∏...
```

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```python
from integrations.obsidian import get_vault

vault = get_vault()

# –°–æ–∑–¥–∞—Ç—å –∑–∞–º–µ—Ç–∫—É
vault.create_note(
    title="–ù–æ–≤–∞—è –∏–¥–µ—è",
    content="–û–ø–∏—Å–∞–Ω–∏–µ –∏–¥–µ–∏...",
    tags=["–ø—Ä–æ–µ–∫—Ç", "–∏–¥–µ—è"]
)

# –ù–∞–π—Ç–∏ –∑–∞–º–µ—Ç–∫–∏
results = vault.search_notes("–ø—Ä–æ–µ–∫—Ç")
```

### 4. Whisper API (integrations/whisper.py)

**–§—É–Ω–∫—Ü–∏—è:** `transcribe_audio()`

**API:** OpenAI Whisper API

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏ –∏–∑ –∞—É–¥–∏–æ —Ñ–∞–π–ª–æ–≤
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ—Ä–º–∞—Ç–æ–≤: MP3, M4A, WAV, OGG
- –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞ –∏–ª–∏ —É–∫–∞–∑–∞–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```python
from integrations.whisper import transcribe_audio

text = transcribe_audio(
    audio_file_path="/path/to/audio.m4a",
    language="ru"  # –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
)
print(text)  # "–î–æ–±–∞–≤—å –≤—Å—Ç—Ä–µ—á—É –∑–∞–≤—Ç—Ä–∞ –≤ —Ç—Ä–∏ —á–∞—Å–∞"
```

### 5. Google TTS (integrations/tts.py)

**–§—É–Ω–∫—Ü–∏–∏:**
- `text_to_speech(text: str) -> str` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è TTS
- `get_or_create_tts_url(text: str, base_url: str) -> str` - —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- `cleanup_old_cache()` - –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤

**–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –•—ç—à: MD5(text)
- –§–æ—Ä–º–∞—Ç: `{hash}.mp3`
- –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞: —Ñ–∞–π–ª—ã —Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```python
from integrations.tts import get_or_create_tts_url

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
audio_url = get_or_create_tts_url(
    text="–°–æ–±—ã—Ç–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä—å",
    base_url="https://your-domain.com"
)
# –í–µ—Ä–Ω—ë—Ç: https://your-domain.com/api/v1/tts/abc123.mp3
```

---

## API Reference

### POST /api/v1/voice-command

**–û–ø–∏—Å–∞–Ω–∏–µ:** –û–±—Ä–∞–±–æ—Ç–∫–∞ –≥–æ–ª–æ—Å–æ–≤–æ–π –∫–æ–º–∞–Ω–¥—ã

**Headers:**
```
Authorization: Bearer YOUR_TOKEN
Content-Type: multipart/form-data
```

**Request:**
```
audio: —Ñ–∞–π–ª (audio/m4a, audio/wav, audio/mp3)
user_id: string
```

**Response:**
```json
{
  "message": "‚úÖ –°–æ–±—ã—Ç–∏–µ '–í—Å—Ç—Ä–µ—á–∞' –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä—å",
  "action": "executed",
  "audio_url": "https://domain.com/api/v1/tts/abc123.mp3",
  "confirmation_id": null
}
```

**–ò–ª–∏ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º:**
```json
{
  "message": "",
  "action": "confirm",
  "audio_url": "https://domain.com/api/v1/tts/def456.mp3",
  "confirmation_id": "550e8400-e29b-41d4-a716-446655440000",
  "confirmation_text": "üìÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ —è –ø–æ–Ω—è–ª: –¥–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ '–í—Å—Ç—Ä–µ—á–∞' –Ω–∞ –∑–∞–≤—Ç—Ä–∞ –≤ 15:00?"
}
```

**–ö–æ–¥—ã –æ—Ç–≤–µ—Ç–æ–≤:**
- `200` - –£—Å–ø–µ—à–Ω–æ
- `401` - –ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω
- `400` - –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å
- `500` - –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞

---

### POST /api/v1/text-command

**–û–ø–∏—Å–∞–Ω–∏–µ:** –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤–æ–π –∫–æ–º–∞–Ω–¥—ã

**Headers:**
```
Authorization: Bearer YOUR_TOKEN
Content-Type: application/json
```

**Request:**
```json
{
  "text": "–î–æ–±–∞–≤—å –≤—Å—Ç—Ä–µ—á—É –∑–∞–≤—Ç—Ä–∞ –≤ 15:00",
  "user_id": "user123"
}
```

**Response:** –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ `/voice-command`

---

### POST /api/v1/confirm

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏–ª–∏ –æ—Ç–º–µ–Ω–∞ –¥–µ–π—Å—Ç–≤–∏—è

**Headers:**
```
Authorization: Bearer YOUR_TOKEN
Content-Type: application/json
```

**Request:**
```json
{
  "confirmation_id": "550e8400-e29b-41d4-a716-446655440000",
  "user_id": "user123",
  "confirmed": true
}
```

**Response:**
```json
{
  "message": "‚úÖ –°–æ–±—ã—Ç–∏–µ '–í—Å—Ç—Ä–µ—á–∞' –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä—å",
  "action": "executed",
  "audio_url": "https://domain.com/api/v1/tts/xyz789.mp3"
}
```

---

### GET /api/v1/tts/{filename}

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–ª—É—á–∏—Ç—å TTS –∞—É–¥–∏–æ —Ñ–∞–π–ª

**Headers:** –Ω–µ —Ç—Ä–µ–±—É—é—Ç—Å—è (–ø—É–±–ª–∏—á–Ω—ã–π endpoint)

**Request:**
```
GET /api/v1/tts/abc123.mp3
```

**Response:**
```
Content-Type: audio/mpeg
Content: <binary audio data>
```

**–ö–æ–¥—ã –æ—Ç–≤–µ—Ç–æ–≤:**
- `200` - –§–∞–π–ª –Ω–∞–π–¥–µ–Ω
- `404` - –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω

---

### GET /api/v1/health

**–û–ø–∏—Å–∞–Ω–∏–µ:** Health check

**Response:**
```json
{
  "status": "ok"
}
```

---

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### config.yaml

**–ü–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**

```yaml
# Telegram Bot
telegram:
  bot_token: "YOUR_BOT_TOKEN"
  allowed_users: []  # –ü—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ = –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

# REST API
api:
  host: "127.0.0.1"
  port: 8000
  auth:
    enabled: true
    bearer_token: "your-random-token"
  cors:
    enabled: true
    origins:
      - "http://localhost"
      - "https://your-domain.com"

# Claude AI
claude:
  api_key: "YOUR_CLAUDE_API_KEY"
  model: "claude-sonnet-4-20250514"
  max_tokens: 4096
  temperature: 0.7

# OpenAI (Whisper)
openai:
  api_key: "YOUR_OPENAI_API_KEY"

# Google Calendar
google:
  calendar:
    credentials_file: "credentials/google_calendar_credentials.json"
    token_file: "data/google_calendar_token.json"
    default_calendar_id: "primary"

  # Google Tasks
  tasks:
    credentials_file: "credentials/google_tasks_credentials.json"
    token_file: "data/google_tasks_token.json"
    task_list_id: "@default"
    shopping_list_id: "@default"

# Obsidian
obsidian:
  vault_path: "/path/to/obsidian/vault"
  notes_folder: "Notes"
  method: "filesystem"

# Text-to-Speech
tts:
  engine: "gtts"
  language: "ru"
  cache_dir: "cache"
  cache_max_age_days: 7

# Database
database:
  path: "data/ai_assistant.db"

# –°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–π –ø–∞–º—è—Ç–∏ (NEW v2.1)
memory:
  enabled: true  # –í–∫–ª—é—á–∏—Ç—å –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—É—é –ø–∞–º—è—Ç—å
  context_days: 30  # –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ N –¥–Ω–µ–π
  cleanup_days: 90  # –£–¥–∞–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ä—à–µ N –¥–Ω–µ–π

# Logging
logging:
  level: "INFO"
  file: "logs/app.log"
  max_size_mb: 10
  backup_count: 5
  format: "json"
```

### .env

**–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**

```env
# Telegram
TELEGRAM_BOT_TOKEN=your_telegram_bot_token

# Claude AI
CLAUDE_API_KEY=your_claude_api_key

# OpenAI
OPENAI_API_KEY=your_openai_api_key

# API Auth
API_BEARER_TOKEN=your_random_secure_token

# Optional overrides
# LOG_LEVEL=DEBUG
# API_HOST=0.0.0.0
# API_PORT=8000
```

### requirements.txt

```
# Core
python>=3.11

# Async
aiohttp==3.9.1
aiosqlite==0.19.0
asyncio==3.4.3

# Telegram
python-telegram-bot==20.7

# API
fastapi==0.104.1
uvicorn[standard]==0.24.0
pydantic==2.5.0
python-multipart==0.0.6

# AI
anthropic==0.7.7
openai==1.3.0

# Google APIs
google-auth==2.25.2
google-auth-oauthlib==1.2.0
google-auth-httplib2==0.2.0
google-api-python-client==2.110.0

# TTS
gTTS==2.5.0

# Utils
pyyaml==6.0.1
python-dotenv==1.0.0
requests==2.31.0

# Audio processing
pydub==0.25.1
```

---

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –°—Ö–µ–º–∞

#### –¢–∞–±–ª–∏—Ü–∞: messages

–•—Ä–∞–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

| –ö–æ–ª–æ–Ω–∫–∞ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|-----|----------|
| id | INTEGER PRIMARY KEY | –ê–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç |
| user_id | TEXT NOT NULL | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| role | TEXT NOT NULL | 'user' –∏–ª–∏ 'assistant' |
| content | TEXT NOT NULL | –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏—è |
| session_id | TEXT | ID —Å–µ—Å—Å–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) |
| timestamp | DATETIME | –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è |

**–ò–Ω–¥–µ–∫—Å—ã:**
```sql
CREATE INDEX idx_messages_user ON messages(user_id);
CREATE INDEX idx_messages_timestamp ON messages(timestamp DESC);
```

#### –¢–∞–±–ª–∏—Ü–∞: confirmations

–•—Ä–∞–Ω–∏—Ç –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π

| –ö–æ–ª–æ–Ω–∫–∞ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|-----|----------|
| id | TEXT PRIMARY KEY | UUID |
| user_id | TEXT NOT NULL | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| action_type | TEXT NOT NULL | –¢–∏–ø –¥–µ–π—Å—Ç–≤–∏—è (add_calendar_event –∏ —Ç.–¥.) |
| action_data | TEXT NOT NULL | JSON —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –¥–µ–π—Å—Ç–≤–∏—è |
| confirmation_text | TEXT NOT NULL | –¢–µ–∫—Å—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| status | TEXT | 'pending', 'confirmed', 'cancelled' |
| created_at | DATETIME | –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è |
| updated_at | DATETIME | –í—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |

**–ò–Ω–¥–µ–∫—Å—ã:**
```sql
CREATE INDEX idx_confirmations_user ON confirmations(user_id);
CREATE INDEX idx_confirmations_status ON confirmations(status);
```

#### –¢–∞–±–ª–∏—Ü–∞: usage_stats

–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è API

| –ö–æ–ª–æ–Ω–∫–∞ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|-----|----------|
| id | INTEGER PRIMARY KEY | –ê–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç |
| user_id | TEXT NOT NULL | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| interface | TEXT NOT NULL | 'telegram' –∏–ª–∏ 'api' |
| action_type | TEXT | –¢–∏–ø –¥–µ–π—Å—Ç–≤–∏—è |
| tokens_used | INTEGER | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤ Claude |
| timestamp | DATETIME | –í—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞ |

**–ò–Ω–¥–µ–∫—Å—ã:**
```sql
CREATE INDEX idx_stats_user ON usage_stats(user_id);
CREATE INDEX idx_stats_timestamp ON usage_stats(timestamp DESC);
```

### –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

**–ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å–æ–æ–±—â–µ–Ω–∏–π:**
```sql
SELECT * FROM messages
WHERE user_id = 'user123'
ORDER BY timestamp DESC
LIMIT 50;
```

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:**
```sql
SELECT
    interface,
    COUNT(*) as requests,
    SUM(tokens_used) as total_tokens
FROM usage_stats
WHERE user_id = 'user123'
GROUP BY interface;
```

**–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:**
```sql
SELECT * FROM confirmations
WHERE user_id = 'user123'
  AND status = 'pending'
  AND created_at > datetime('now', '-1 hour')
ORDER BY created_at DESC;
```

---

## –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

**–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ:**
- Ubuntu 22.04 LTS / Debian 12+
- 2 GB RAM
- 20 GB disk
- Python 3.11+

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ:**
- 4 GB RAM
- 50 GB disk
- SSD storage

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

**1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞:**
```bash
sudo apt update && sudo apt upgrade -y
sudo apt install -y git python3.11 python3.11-venv \
    nginx certbot python3-certbot-nginx sqlite3 ffmpeg
```

**2. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
```bash
sudo useradd -m -s /bin/bash ai-assistant
sudo mkdir -p /opt/ai-assistant
sudo chown ai-assistant:ai-assistant /opt/ai-assistant
```

**3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞:**
```bash
cd /opt/ai-assistant
git clone <repo-url> .

python3.11 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

**4. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
```bash
cp config.yaml.example config.yaml
cp .env.example .env

nano config.yaml  # –ù–∞—Å—Ç—Ä–æ–∏—Ç—å
nano .env         # –ù–∞—Å—Ç—Ä–æ–∏—Ç—å
```

**5. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î:**
```bash
python -c "import asyncio; from utils.database import Database; asyncio.run(Database().init_db())"
```

**6. Google OAuth:**
```bash
# –ó–∞–≥—Ä—É–∑–∏—Ç—å credentials —Å Google Cloud Console
# –ü–æ–º–µ—Å—Ç–∏—Ç—å –≤ credentials/

# –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è
python -c "from integrations.google_calendar import get_calendar; get_calendar()"
python -c "from integrations.google_tasks import get_tasks; get_tasks()"
```

**7. Systemd —Å–µ—Ä–≤–∏—Å—ã:**
```bash
sudo cp systemd/*.service /etc/systemd/system/
sudo systemctl daemon-reload
sudo systemctl enable ai-assistant-bot ai-assistant-api
sudo systemctl start ai-assistant-bot ai-assistant-api
```

**8. Nginx + HTTPS:**
```bash
sudo cp nginx/ai_assistant.conf /etc/nginx/sites-available/
sudo ln -s /etc/nginx/sites-available/ai_assistant /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx

# Let's Encrypt
sudo certbot --nginx -d your-domain.com
```

**9. –ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# API health check
curl https://your-domain.com/api/v1/health

# –õ–æ–≥–∏
sudo journalctl -u ai-assistant-bot -f
sudo journalctl -u ai-assistant-api -f
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

**–õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**
```bash
tail -f /opt/ai-assistant/logs/app.log
```

**–°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏:**
```bash
sudo journalctl -u ai-assistant-bot -n 50
sudo journalctl -u ai-assistant-api -n 50
```

**Nginx –ª–æ–≥–∏:**
```bash
tail -f /var/log/nginx/ai_assistant_access.log
tail -f /var/log/nginx/ai_assistant_error.log
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤:**
```bash
htop
df -h
du -sh /opt/ai-assistant/*
```

### –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

**–°–∫—Ä–∏–ø—Ç –±—ç–∫–∞–ø–∞:**
```bash
#!/bin/bash
BACKUP_DIR="/opt/backups/ai-assistant"
DATE=$(date +%Y%m%d_%H%M%S)

mkdir -p $BACKUP_DIR

# –ë–î
cp /opt/ai-assistant/data/ai_assistant.db $BACKUP_DIR/db_$DATE.db

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
tar -czf $BACKUP_DIR/config_$DATE.tar.gz \
    /opt/ai-assistant/config.yaml \
    /opt/ai-assistant/.env \
    /opt/ai-assistant/credentials/

# –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ (>30 –¥–Ω–µ–π)
find $BACKUP_DIR -name "*.tar.gz" -mtime +30 -delete
find $BACKUP_DIR -name "*.db" -mtime +30 -delete
```

**Cron:**
```
0 3 * * * /opt/ai-assistant/backup.sh
```

---

## –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤

### main.py

```python
"""
–ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –∑–∞–ø—É—Å–∫–∞ AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞
–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç multiprocessing –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞ –∏ API
"""

import sys
import asyncio
import argparse
from multiprocessing import Process
import uvicorn

from bot.telegram_bot import TelegramBot
from utils.logger import get_logger

logger = get_logger(__name__)


def run_telegram_bot():
    """–ó–∞–ø—É—Å–∫ Telegram –±–æ—Ç–∞"""
    try:
        logger.info("–ó–∞–ø—É—Å–∫ Telegram –±–æ—Ç–∞...")
        bot = TelegramBot()
        bot.run()
    except KeyboardInterrupt:
        logger.info("Telegram –±–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –≤ Telegram –±–æ—Ç–µ: {e}", exc_info=True)
        sys.exit(1)


def run_api_server():
    """–ó–∞–ø—É—Å–∫ API —Å–µ—Ä–≤–µ—Ä–∞"""
    try:
        logger.info("–ó–∞–ø—É—Å–∫ API —Å–µ—Ä–≤–µ—Ä–∞...")
        from utils.config import load_config
        config = load_config()

        uvicorn.run(
            "api.app:app",
            host=config['api']['host'],
            port=config['api']['port'],
            log_level="info"
        )
    except KeyboardInterrupt:
        logger.info("API —Å–µ—Ä–≤–µ—Ä –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –≤ API —Å–µ—Ä–≤–µ—Ä–µ: {e}", exc_info=True)
        sys.exit(1)


def main():
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è"""
    parser = argparse.ArgumentParser(description='AI Assistant')
    parser.add_argument('--bot-only', action='store_true', help='Run only Telegram bot')
    parser.add_argument('--api-only', action='store_true', help='Run only API server')
    args = parser.parse_args()

    if args.bot_only:
        logger.info("–†–µ–∂–∏–º: —Ç–æ–ª—å–∫–æ Telegram –±–æ—Ç")
        run_telegram_bot()
    elif args.api_only:
        logger.info("–†–µ–∂–∏–º: —Ç–æ–ª—å–∫–æ API —Å–µ—Ä–≤–µ—Ä")
        run_api_server()
    else:
        logger.info("–†–µ–∂–∏–º: Telegram –±–æ—Ç + API —Å–µ—Ä–≤–µ—Ä (multiprocessing)")

        # –ó–∞–ø—É—Å–∫ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–∞—Ö
        bot_process = Process(target=run_telegram_bot, name="TelegramBot")
        api_process = Process(target=run_api_server, name="APIServer")

        try:
            bot_process.start()
            api_process.start()

            bot_process.join()
            api_process.join()

        except KeyboardInterrupt:
            logger.info("–ü–æ–ª—É—á–µ–Ω —Å–∏–≥–Ω–∞–ª –æ—Å—Ç–∞–Ω–æ–≤–∫–∏")
            bot_process.terminate()
            api_process.terminate()
            bot_process.join()
            api_process.join()
            logger.info("–í—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã")


if __name__ == "__main__":
    main()
```

### agent/claude_agent.py

```python
"""
Claude AI Agent —Å Function Calling
"""

import json
import uuid
from datetime import datetime, timedelta
from typing import Dict, Any, List, Optional
from anthropic import Anthropic

from utils.logger import get_logger
from utils.config import load_config
from agent.tools import TOOLS, get_system_prompt, get_tool_by_name

logger = get_logger(__name__)


class ClaudeAgent:
    """–ö–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Claude AI —á–µ—Ä–µ–∑ Function Calling"""

    def __init__(self, config: Optional[Dict[str, Any]] = None):
        """
        –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–≥–µ–Ω—Ç–∞

        Args:
            config: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–µ—Å–ª–∏ None, –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
        """
        if config is None:
            config = load_config()

        self.config = config
        self.api_key = config['claude']['api_key']
        self.model = config['claude'].get('model', 'claude-sonnet-4-20250514')
        self.max_tokens = config['claude'].get('max_tokens', 4096)
        self.temperature = config['claude'].get('temperature', 0.7)

        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Anthropic –∫–ª–∏–µ–Ω—Ç–∞
        self.client = Anthropic(api_key=self.api_key)

        logger.info(f"Claude Agent –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω (–º–æ–¥–µ–ª—å: {self.model})")

    async def process_message(
        self,
        message: str,
        user_id: str,
        conversation_history: Optional[List[Dict[str, str]]] = None
    ) -> Dict[str, Any]:
        """
        –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ Claude

        Args:
            message: –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
            user_id: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            conversation_history: –ò—Å—Ç–æ—Ä–∏—è —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

        Returns:
            –†–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å –ø–æ–ª—è–º–∏:
            - action: "confirm" –∏–ª–∏ "executed"
            - action_type: —Ç–∏–ø –¥–µ–π—Å—Ç–≤–∏—è
            - confirmation_text: —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (–µ—Å–ª–∏ action="confirm")
            - response_text: —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
            - confirmation_id: ID –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (–µ—Å–ª–∏ action="confirm")
            - tokens_used: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤
        """
        logger.info(f"–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç {user_id}: {message}")

        try:
            # –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç —Å —Ç–µ–∫—É—â–µ–π –¥–∞—Ç–æ–π/–≤—Ä–µ–º–µ–Ω–µ–º
            today = datetime.now().strftime("%Y-%m-%d (%A)")
            current_time = datetime.now().strftime("%H:%M")
            system_prompt = get_system_prompt(today, current_time)

            # –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π
            messages = []

            if conversation_history:
                for msg in conversation_history:
                    messages.append({
                        "role": msg["role"],
                        "content": msg["content"]
                    })

            # –î–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            messages.append({
                "role": "user",
                "content": message
            })

            # –í—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å –∫ Claude
            response = self.client.messages.create(
                model=self.model,
                max_tokens=self.max_tokens,
                temperature=self.temperature,
                system=system_prompt,
                tools=TOOLS,
                messages=messages
            )

            logger.info(f"–ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –æ—Ç Claude (stop_reason: {response.stop_reason})")

            # –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã
            tokens_used = response.usage.input_tokens + response.usage.output_tokens

            # –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—Ç–≤–µ—Ç
            return await self._process_response(response, user_id, tokens_used)

        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —á–µ—Ä–µ–∑ Claude: {e}", exc_info=True)
            return {
                "action": "executed",
                "action_type": "error",
                "response_text": f"‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: {str(e)}",
                "tokens_used": 0
            }

    async def _process_response(
        self,
        response,
        user_id: str,
        tokens_used: int
    ) -> Dict[str, Any]:
        """
        –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—Ç–≤–µ—Ç –æ—Ç Claude

        Args:
            response: –û—Ç–≤–µ—Ç –æ—Ç Claude API
            user_id: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            tokens_used: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤

        Returns:
            –†–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏
        """
        # –ï—Å–ª–∏ Claude —Ö–æ—á–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
        if response.stop_reason == "tool_use":
            return await self._handle_tool_use(response, user_id, tokens_used)

        # –ï—Å–ª–∏ Claude –ø—Ä–æ—Å—Ç–æ –æ—Ç–≤–µ—Ç–∏–ª —Ç–µ–∫—Å—Ç–æ–º
        elif response.stop_reason == "end_turn":
            # –ò–∑–≤–ª–µ—á—å —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç
            text_content = ""
            for block in response.content:
                if block.type == "text":
                    text_content += block.text

            return {
                "action": "executed",
                "action_type": "general",
                "response_text": text_content,
                "tokens_used": tokens_used
            }

        else:
            logger.warning(f"–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π stop_reason: {response.stop_reason}")
            return {
                "action": "executed",
                "action_type": "unknown",
                "response_text": "–ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –æ—Ç –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞",
                "tokens_used": tokens_used
            }

    async def _handle_tool_use(
        self,
        response,
        user_id: str,
        tokens_used: int
    ) -> Dict[str, Any]:
        """
        –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ Claude

        Args:
            response: –û—Ç–≤–µ—Ç –æ—Ç Claude —Å tool_use
            user_id: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            tokens_used: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤

        Returns:
            –†–µ–∑—É–ª—å—Ç–∞—Ç —Å –∑–∞–ø—Ä–æ—Å–æ–º –Ω–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
        """
        # –ò–∑–≤–ª–µ—á—å –≤—Å–µ tool_use –±–ª–æ–∫–∏
        tool_uses = [block for block in response.content if block.type == "tool_use"]

        if not tool_uses:
            return {
                "action": "executed",
                "action_type": "no_tools",
                "response_text": "–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ",
                "tokens_used": tokens_used
            }

        # –ü–æ–∫–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
        tool_use = tool_uses[0]
        tool_name = tool_use.name
        tool_input = tool_use.input

        logger.info(f"Claude —Ö–æ—á–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: {tool_name}")
        logger.debug(f"–ü–∞—Ä–∞–º–µ—Ç—Ä—ã: {tool_input}")

        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —Ç—Ä–µ–±—É–µ—Ç –ª–∏ –¥–µ–π—Å—Ç–≤–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
        requires_confirmation = self._requires_confirmation(tool_name)

        if requires_confirmation:
            # –°–æ–∑–¥–∞—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
            confirmation_id = str(uuid.uuid4())
            confirmation_text = self._generate_confirmation_text(tool_name, tool_input)

            return {
                "action": "confirm",
                "action_type": tool_name,
                "confirmation_id": confirmation_id,
                "confirmation_text": confirmation_text,
                "response_text": "",  # –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
                "tool_name": tool_name,
                "tool_input": tool_input,
                "tokens_used": tokens_used
            }
        else:
            # –í—ã–ø–æ–ª–Ω–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ —Å—Ä–∞–∑—É
            result = await self._execute_tool(tool_name, tool_input, user_id)

            return {
                "action": "executed",
                "action_type": tool_name,
                "response_text": result["message"],
                "tokens_used": tokens_used
            }

    def _requires_confirmation(self, tool_name: str) -> bool:
        """
        –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —Ç—Ä–µ–±—É–µ—Ç –ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

        Args:
            tool_name: –ù–∞–∑–≤–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞

        Returns:
            True –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
        """
        # –î–µ–π—Å—Ç–≤–∏—è, —Ç—Ä–µ–±—É—é—â–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
        confirmation_required = [
            "add_calendar_event",
            "add_task",
            "add_shopping_item",
            "create_note"
        ]

        return tool_name in confirmation_required

    def _generate_confirmation_text(self, tool_name: str, tool_input: Dict[str, Any]) -> str:
        """
        –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ

        Args:
            tool_name: –ù–∞–∑–≤–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
            tool_input: –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞

        Returns:
            –¢–µ–∫—Å—Ç –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
        """
        if tool_name == "add_calendar_event":
            summary = tool_input.get("summary", "—Å–æ–±—ã—Ç–∏–µ")
            start_time = tool_input.get("start_time", "")

            # –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å ISO –≤—Ä–µ–º—è –≤ —á–∏—Ç–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç
            try:
                dt = datetime.fromisoformat(start_time.replace('Z', '+00:00'))
                formatted_time = dt.strftime("%d %B –≤ %H:%M")
            except:
                formatted_time = start_time

            return f"üìÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ —è –ø–æ–Ω—è–ª: –¥–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ '{summary}' –Ω–∞ {formatted_time}?"

        elif tool_name == "add_task":
            title = tool_input.get("title", "–∑–∞–¥–∞—á—É")
            return f"‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ —è –ø–æ–Ω—è–ª: –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É '{title}'?"

        elif tool_name == "add_shopping_item":
            items = tool_input.get("items", [])
            items_str = ", ".join(items)
            return f"üõí –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ —è –ø–æ–Ω—è–ª: –¥–æ–±–∞–≤–∏—Ç—å –≤ –ø–æ–∫—É–ø–∫–∏: {items_str}?"

        elif tool_name == "create_note":
            title = tool_input.get("title", "–∑–∞–º–µ—Ç–∫—É")
            return f"üìù –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ —è –ø–æ–Ω—è–ª: —Å–æ–∑–¥–∞—Ç—å –∑–∞–º–µ—Ç–∫—É '{title}'?"

        else:
            return f"–ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ —è –ø–æ–Ω—è–ª: –≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ {tool_name}?"

    async def _execute_tool(
        self,
        tool_name: str,
        tool_input: Dict[str, Any],
        user_id: str
    ) -> Dict[str, Any]:
        """
        –í—ã–ø–æ–ª–Ω—è–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç

        Args:
            tool_name: –ù–∞–∑–≤–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
            tool_input: –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
            user_id: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

        Returns:
            –†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å –ø–æ–ª–µ–º "message"
        """
        logger.info(f"–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞: {tool_name}")

        try:
            # –ò–º–ø–æ—Ä—Ç—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
            from integrations.google_calendar import get_calendar
            from integrations.google_tasks import get_tasks as get_tasks_client
            from integrations.obsidian import get_vault

            if tool_name == "add_calendar_event":
                # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Google Calendar
                calendar = get_calendar()
                result = calendar.add_event(
                    summary=tool_input.get('summary'),
                    start_time=tool_input.get('start_time'),
                    end_time=tool_input.get('end_time'),
                    description=tool_input.get('description'),
                    location=tool_input.get('location')
                )
                return {
                    "success": True,
                    "message": f"‚úÖ –°–æ–±—ã—Ç–∏–µ '{tool_input.get('summary')}' –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä—å"
                }

            elif tool_name == "get_calendar_events":
                # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Google Calendar
                calendar = get_calendar()
                events = calendar.get_events(
                    time_min=tool_input.get('time_min'),
                    time_max=tool_input.get('time_max'),
                    max_results=tool_input.get('max_results', 10)
                )

                if not events:
                    return {
                        "success": True,
                        "message": "üìÖ –°–æ–±—ã—Ç–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
                    }

                # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏—è –¥–ª—è –æ—Ç–≤–µ—Ç–∞
                events_text = []
                for event in events:
                    start = datetime.fromisoformat(event['start'].replace('Z', '+00:00'))
                    events_text.append(f"‚Ä¢ {event['summary']} ({start.strftime('%d.%m –≤ %H:%M')})")

                return {
                    "success": True,
                    "message": f"üìÖ –ù–∞–π–¥–µ–Ω–æ —Å–æ–±—ã—Ç–∏–π: {len(events)}\n" + "\n".join(events_text)
                }

            elif tool_name == "add_task":
                # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Google Tasks
                tasks = get_tasks_client()
                result = tasks.add_task(
                    title=tool_input.get('title'),
                    notes=tool_input.get('notes'),
                    due_date=tool_input.get('due_date')
                )
                return {
                    "success": True,
                    "message": f"‚úÖ –ó–∞–¥–∞—á–∞ '{tool_input.get('title')}' –¥–æ–±–∞–≤–ª–µ–Ω–∞"
                }

            elif tool_name == "add_shopping_item":
                # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Google Tasks
                tasks = get_tasks_client()
                items = tool_input.get("items", [])
                result = tasks.add_shopping_items(items)
                return {
                    "success": True,
                    "message": f"üõí –î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –ø–æ–∫—É–ø–∫–∏: {', '.join(items)}"
                }

            elif tool_name == "get_tasks":
                # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Google Tasks
                tasks_client = get_tasks_client()
                task_list = tool_input.get('task_list', 'tasks')
                show_completed = tool_input.get('show_completed', False)

                if task_list == 'shopping':
                    task_list_items = tasks_client.get_shopping_list(show_completed)
                else:
                    task_list_items = tasks_client.get_tasks(show_completed=show_completed)

                if not task_list_items:
                    return {
                        "success": True,
                        "message": "üìã –ó–∞–¥–∞—á–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
                    }

                # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á–∏
                tasks_text = []
                for task in task_list_items:
                    status_icon = "‚úÖ" if task['status'] == 'completed' else "‚¨ú"
                    tasks_text.append(f"{status_icon} {task['title']}")

                return {
                    "success": True,
                    "message": f"üìã –ù–∞–π–¥–µ–Ω–æ –∑–∞–¥–∞—á: {len(task_list_items)}\n" + "\n".join(tasks_text[:10])
                }

            elif tool_name == "create_note":
                # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Obsidian
                vault = get_vault()
                result = vault.create_note(
                    title=tool_input.get('title'),
                    content=tool_input.get('content'),
                    tags=tool_input.get('tags')
                )
                return {
                    "success": True,
                    "message": f"üìù –ó–∞–º–µ—Ç–∫–∞ '{tool_input.get('title')}' —Å–æ–∑–¥–∞–Ω–∞ –≤ Obsidian"
                }

            elif tool_name == "search_notes":
                # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Obsidian
                vault = get_vault()
                results = vault.search_notes(
                    query=tool_input.get('query'),
                    limit=tool_input.get('limit', 5)
                )

                if not results:
                    return {
                        "success": True,
                        "message": f"üîç –ó–∞–º–µ—Ç–∫–∏ –ø–æ –∑–∞–ø—Ä–æ—Å—É '{tool_input.get('query')}' –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
                    }

                # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                notes_text = []
                for note in results:
                    notes_text.append(f"‚Ä¢ {note['title']}")

                return {
                    "success": True,
                    "message": f"üîç –ù–∞–π–¥–µ–Ω–æ –∑–∞–º–µ—Ç–æ–∫: {len(results)}\n" + "\n".join(notes_text)
                }

            else:
                return {
                    "success": False,
                    "message": f"‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: {tool_name}"
                }

        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ {tool_name}: {e}", exc_info=True)
            return {
                "success": False,
                "message": f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –¥–µ–π—Å—Ç–≤–∏—è: {str(e)}"
            }

    async def execute_confirmed_action(
        self,
        confirmation_data: Dict[str, Any],
        user_id: str
    ) -> Dict[str, Any]:
        """
        –í—ã–ø–æ–ª–Ω—è–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º

        Args:
            confirmation_data: –î–∞–Ω–Ω—ã–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (–∏–∑ –ë–î)
            user_id: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

        Returns:
            –†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
        """
        action_data = json.loads(confirmation_data['action_data'])

        tool_name = action_data.get('tool_name')
        tool_input = action_data.get('tool_input')

        if not tool_name or not tool_input:
            return {
                "success": False,
                "message": "‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è"
            }

        # –í—ã–ø–æ–ª–Ω–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
        result = await self._execute_tool(tool_name, tool_input, user_id)

        return result
```

*[–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –≤ —Å–ª–µ–¥—É—é—â–µ–π —á–∞—Å—Ç–∏ –∏–∑-–∑–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–ª–∏–Ω—ã...]*

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç v2.1, –≤–∫–ª—é—á–∞—è:

- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å–∏—Å—Ç–µ–º—ã
- –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏ –∏—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ
- –ü–æ–ª–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ–∞–π–ª–æ–≤
- –°—Ö–µ–º—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- API Reference
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é
- **NEW:** –ì–∏–±—Ä–∏–¥–Ω—É—é LLM –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É (Claude + Ollama)
- **NEW:** –°–∏—Å—Ç–µ–º—É –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–π –ø–∞–º—è—Ç–∏

**–°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞:** Production Ready ‚úÖ

**–û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ v1.0:**
- ‚úÖ –ì–æ–ª–æ—Å–æ–≤–æ–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç "–ó–∏–Ω–æ—á–∫–∞" —Å wake word –∞–∫—Ç–∏–≤–∞—Ü–∏–µ–π
- ‚úÖ –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ - –ª–µ–≥–∫–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É Claude API –∏ Ollama
- ‚úÖ –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∞—è –ø–∞–º—è—Ç—å - –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –∏–∑—É—á–∞–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è —ç–∫–æ–Ω–æ–º–∏—è - Ollama –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)
- ‚úÖ –õ—É—á—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ - –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ-–∑–∞–≤–∏—Å–∏–º—ã–µ –æ—Ç–≤–µ—Ç—ã
- ‚úÖ –ì–æ–ª–æ—Å–æ–≤—ã–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π

**–ö–æ–Ω—Ç–∞–∫—Ç—ã:**
- GitHub: [—Å—Å—ã–ª–∫–∞ –Ω–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π]
- Email: support@example.com

---

*–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞: 2026-01-13*
*–í–µ—Ä—Å–∏—è: 1.0*
*–°—Ç–∞—Ç—É—Å: –ì–æ—Ç–æ–≤ –∫ –ø–µ—Ä–≤–æ–º—É –∑–∞–ø—É—Å–∫—É –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é*
